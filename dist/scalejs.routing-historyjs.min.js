(function(a){function b(a){if(a.isDisposed)throw new Error(ca)}function c(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b}function d(a,b){if(da&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(ha)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+ha+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0,e=b.length;e>d;d++){var h=b[d];f(h)||g(h)||!h||c.push(h)}return c.join("\n")}function f(a){var b=j(a);if(!b)return!1;var c=b[0],d=b[1];return c===fa&&d>=ga&&Yb>=d}function g(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function h(){if(da)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=j(c);if(!d)return;return fa=d[0],d[1]}}function j(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function k(a){var b=[];if(!Ja(a))return b;Ia.nonEnumArgs&&a.length&&Ka(a)&&(a=Ma.call(a));var c=Ia.enumPrototypes&&"function"==typeof a,d=Ia.enumErrorProps&&(a===Da||a instanceof Error);for(var e in a)c&&"prototype"==e||d&&("message"==e||"name"==e)||b.push(e);if(Ia.nonEnumShadows&&a!==Ea){var f=a.constructor,g=-1,h=pa;if(a===(f&&f.prototype))var i=a===Fa?za:a===Da?ua:Aa.call(a),j=Ha[i];for(;++g<h;)e=oa[g],j&&j[e]||!Ba.call(a,e)||b.push(e)}return b}function l(a,b,c){for(var d=-1,e=c(a),f=e.length;++d<f;){var g=e[d];if(b(a[g],g,a)===!1)break}return a}function m(a,b){return l(a,b,k)}function n(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}function o(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;var e=typeof a,f=typeof b;if(a===a&&(null==a||null==b||"function"!=e&&"object"!=e&&"function"!=f&&"object"!=f))return!1;var g=Aa.call(a),h=Aa.call(b);if(g==qa&&(g=xa),h==qa&&(h=xa),g!=h)return!1;switch(g){case sa:case ta:return+a==+b;case wa:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case ya:case za:return a==String(b)}var i=g==ra;if(!i){if(g!=xa||!Ia.nodeClass&&(n(a)||n(b)))return!1;var j=!Ia.argsObject&&Ka(a)?Object:a.constructor,k=!Ia.argsObject&&Ka(b)?Object:b.constructor;if(!(j==k||Ba.call(a,"constructor")&&Ba.call(b,"constructor")||aa(j)&&j instanceof j&&aa(k)&&k instanceof k)&&("constructor"in a&&"constructor"in b))return!1}c||(c=[]),d||(d=[]);for(var l=c.length;l--;)if(c[l]==a)return d[l]==b;var p=0,q=!0;if(c.push(a),d.push(b),i){if(l=a.length,p=b.length,q=p==l)for(;p--;){var r=b[p];if(!(q=o(a[p],r,c,d)))break}}else m(b,function(b,e,f){return Ba.call(f,e)?(p++,q=Ba.call(a,e)&&o(a[e],b,c,d)):void 0}),q&&m(a,function(a,b,c){return Ba.call(c,b)?q=--p>-1:void 0});return c.pop(),d.pop(),q}function p(a,b){for(var c=new Array(a),d=0;a>d;d++)c[d]=b();return c}function q(a,b){this.id=a,this.value=b}function r(a,b){this.scheduler=a,this.disposable=b,this.isDisposed=!1}function t(a,b){b.isDisposed||(b.isDisposed=!0,b.disposable.dispose())}function u(){this._s=s}function v(){this._s=s,this._l=s.length,this._i=0}function w(a){this._a=a}function x(a){this._a=a,this._l=B(a),this._i=0}function y(a){return"number"==typeof a&&O.isFinite(a)}function z(b){var c,d=b[ia];if(!d&&"string"==typeof b)return c=new u(b),c[ia]();if(!d&&b.length!==a)return c=new w(b),c[ia]();if(!d)throw new TypeError("Object is not iterable");return b[ia]()}function A(a){var b=+a;return 0===b?b:isNaN(b)?b:0>b?-1:1}function B(a){var b=+a.length;return isNaN(b)?0:0!==b&&y(b)?(b=A(b)*Math.floor(Math.abs(b)),0>=b?0:b>Eb?Eb:b):b}function C(a,b){return V(a)||(a=db),new Tb(function(c){var d=0,e=b.length;return a.scheduleRecursive(function(a){e>d?(c.onNext(b[d++]),a()):c.onCompleted()})})}function D(a,b){return new Tb(function(c){var d=new Xa,e=new Ya;return e.setDisposable(d),d.setDisposable(a.subscribe(c.onNext.bind(c),function(a){var d,f;try{f=b(a)}catch(g){return void c.onError(g)}_(f)&&(f=Bb(f)),d=new Xa,e.setDisposable(d),d.setDisposable(f.subscribe(c))},c.onCompleted.bind(c))),e},a)}function E(a,b){var c=this;return new Tb(function(d){var e=0,f=a.length;return c.subscribe(function(c){if(f>e){var g,h=a[e++];try{g=b(c,h)}catch(i){return d.onError(i)}d.onNext(g)}else d.onCompleted()},function(a){d.onError(a)},function(){d.onCompleted()})},c)}function F(){return!1}function G(){return[]}function H(a,b,c){var d=na(b,c,3);return a.map(function(b,c){var e=d(b,c,a);return _(e)&&(e=Bb(e)),(la(e)||ka(e))&&(e=Fb(e)),e}).concatAll()}function I(a,b,c){for(var d=0,e=a.length;e>d;d++)if(c(a[d],b))return d;return-1}function J(a){this.comparer=a,this.set=[]}function K(a,b,c){this.observer=a,this.selector=b,this.source=c,this.index=0,this.isStopped=!1}function L(a,b,c){var d=na(b,c,3);return a.map(function(b,c){var e=d(b,c,a);return _(e)&&(e=Bb(e)),(la(e)||ka(e))&&(e=Fb(e)),e}).mergeAll()}function M(a,b,c){this.observer=a,this.predicate=b,this.source=c,this.index=0,this.isStopped=!1}var N={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},O=N[typeof window]&&window||this,P=N[typeof exports]&&exports&&!exports.nodeType&&exports,Q=N[typeof module]&&module&&!module.nodeType&&module,R=Q&&Q.exports===P&&P,S=N[typeof global]&&global;!S||S.global!==S&&S.window!==S||(O=S);var T={internals:{},config:{Promise:O.Promise},helpers:{}},U=T.helpers.noop=function(){},V=(T.helpers.notDefined=function(a){return"undefined"==typeof a},T.helpers.isScheduler=function(a){return a instanceof T.Scheduler}),W=T.helpers.identity=function(a){return a},X=(T.helpers.pluck=function(a){return function(b){return b[a]}},T.helpers.just=function(a){return function(){return a}},T.helpers.defaultNow=Date.now),Y=T.helpers.defaultComparer=function(a,b){return La(a,b)},Z=T.helpers.defaultSubComparer=function(a,b){return a>b?1:b>a?-1:0},$=(T.helpers.defaultKeySerializer=function(a){return a.toString()},T.helpers.defaultError=function(a){throw a}),_=T.helpers.isPromise=function(a){return!!a&&"function"==typeof a.then},aa=(T.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},T.helpers.not=function(a){return!a},T.helpers.isFunction=function(){var a=function(a){return"function"==typeof a||!1};return a(/x/)&&(a=function(a){return"function"==typeof a&&"[object Function]"==Aa.call(a)}),a}()),ba="Argument out of range",ca="Object has been disposed";T.config.longStackSupport=!1;var da=!1;try{throw new Error}catch(ea){da=!!ea.stack}var fa,ga=h(),ha="From previous event:",ia="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";O.Set&&"function"==typeof(new O.Set)["@@iterator"]&&(ia="@@iterator");var ja=T.doneEnumerator={done:!0,value:a},ka=T.helpers.isIterable=function(b){return b[ia]!==a},la=T.helpers.isArrayLike=function(b){return b&&b.length!==a};T.helpers.iterator=ia;var ma,na=T.internals.bindCallback=function(a,b,c){if("undefined"==typeof b)return a;switch(c){case 0:return function(){return a.call(b)};case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}},oa=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],pa=oa.length,qa="[object Arguments]",ra="[object Array]",sa="[object Boolean]",ta="[object Date]",ua="[object Error]",va="[object Function]",wa="[object Number]",xa="[object Object]",ya="[object RegExp]",za="[object String]",Aa=Object.prototype.toString,Ba=Object.prototype.hasOwnProperty,Ca=Aa.call(arguments)==qa,Da=Error.prototype,Ea=Object.prototype,Fa=String.prototype,Ga=Ea.propertyIsEnumerable;try{ma=!(Aa.call(document)==xa&&!({toString:0}+""))}catch(ea){ma=!0}var Ha={};Ha[ra]=Ha[ta]=Ha[wa]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Ha[sa]=Ha[za]={constructor:!0,toString:!0,valueOf:!0},Ha[ua]=Ha[va]=Ha[ya]={constructor:!0,toString:!0},Ha[xa]={constructor:!0};var Ia={};!function(){var a=function(){this.x=1},b=[];a.prototype={valueOf:1,y:1};for(var c in new a)b.push(c);for(c in arguments);Ia.enumErrorProps=Ga.call(Da,"message")||Ga.call(Da,"name"),Ia.enumPrototypes=Ga.call(a,"prototype"),Ia.nonEnumArgs=0!=c,Ia.nonEnumShadows=!/valueOf/.test(b)}(1);var Ja=T.internals.isObject=function(a){var b=typeof a;return a&&("function"==b||"object"==b)||!1},Ka=function(a){return a&&"object"==typeof a?Aa.call(a)==qa:!1};Ca||(Ka=function(a){return a&&"object"==typeof a?Ba.call(a,"callee"):!1});var La=T.internals.isEqual=function(a,b){return o(a,b,[],[])},Ma=({}.hasOwnProperty,Array.prototype.slice),Na=this.inherits=T.internals.inherits=function(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c},Oa=T.internals.addProperties=function(a){for(var b=[],c=1,d=arguments.length;d>c;c++)b.push(arguments[c]);for(var e=0,f=b.length;f>e;e++){var g=b[e];for(var h in g)a[h]=g[h]}},Pa=T.internals.addRef=function(a,b){return new Tb(function(c){return new Sa(b.getDisposable(),a.subscribe(c))})};q.prototype.compareTo=function(a){var b=this.value.compareTo(a.value);return 0===b&&(b=this.id-a.id),b};var Qa=T.internals.PriorityQueue=function(a){this.items=new Array(a),this.length=0},Ra=Qa.prototype;Ra.isHigherPriority=function(a,b){return this.items[a].compareTo(this.items[b])<0},Ra.percolate=function(a){if(!(a>=this.length||0>a)){var b=a-1>>1;if(!(0>b||b===a)&&this.isHigherPriority(a,b)){var c=this.items[a];this.items[a]=this.items[b],this.items[b]=c,this.percolate(b)}}},Ra.heapify=function(a){if(+a||(a=0),!(a>=this.length||0>a)){var b=2*a+1,c=2*a+2,d=a;if(b<this.length&&this.isHigherPriority(b,d)&&(d=b),c<this.length&&this.isHigherPriority(c,d)&&(d=c),d!==a){var e=this.items[a];this.items[a]=this.items[d],this.items[d]=e,this.heapify(d)}}},Ra.peek=function(){return this.items[0].value},Ra.removeAt=function(b){this.items[b]=this.items[--this.length],this.items[this.length]=a,this.heapify()},Ra.dequeue=function(){var a=this.peek();return this.removeAt(0),a},Ra.enqueue=function(a){var b=this.length++;this.items[b]=new q(Qa.count++,a),this.percolate(b)},Ra.remove=function(a){for(var b=0;b<this.length;b++)if(this.items[b].value===a)return this.removeAt(b),!0;return!1},Qa.count=0;var Sa=T.CompositeDisposable=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);this.disposables=a,this.isDisposed=!1,this.length=this.disposables.length},Ta=Sa.prototype;Ta.add=function(a){this.isDisposed?a.dispose():(this.disposables.push(a),this.length++)},Ta.remove=function(a){var b=!1;if(!this.isDisposed){var c=this.disposables.indexOf(a);-1!==c&&(b=!0,this.disposables.splice(c,1),this.length--,a.dispose())}return b},Ta.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var a=[],b=0,c=this.disposables.length;c>b;b++)a.push(this.disposables[b]);for(this.disposables=[],this.length=0,b=0,c=a.length;c>b;b++)a[b].dispose()}},Ta.toArray=function(){for(var a=[],b=this.disposables.length;b>i;i++)a.push(this.disposables[i]);return a};var Ua=T.Disposable=function(a){this.isDisposed=!1,this.action=a||U};Ua.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var Va=Ua.create=function(a){return new Ua(a)},Wa=Ua.empty={dispose:U},Xa=T.SingleAssignmentDisposable=function(){function a(){this.isDisposed=!1,this.current=null}var b=a.prototype;return b.getDisposable=function(){return this.current},b.setDisposable=function(a){var b=this.isDisposed;if(!b){var c=this.current;this.current=a}c&&c.dispose(),b&&a&&a.dispose()},b.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var a=this.current;this.current=null}a&&a.dispose()},a}(),Ya=T.SerialDisposable=Xa,Za=T.RefCountDisposable=function(){function a(a){this.disposable=a,this.disposable.count++,this.isInnerDisposed=!1}function b(a){this.underlyingDisposable=a,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}return a.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},b.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},b.prototype.getDisposable=function(){return this.isDisposed?Wa:new a(this)},b}();r.prototype.dispose=function(){this.scheduler.scheduleWithState(this,t)};var $a=T.internals.ScheduledItem=function(a,b,c,d,e){this.scheduler=a,this.state=b,this.action=c,this.dueTime=d,this.comparer=e||Z,this.disposable=new Xa};$a.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},$a.prototype.compareTo=function(a){return this.comparer(this.dueTime,a.dueTime)},$a.prototype.isCancelled=function(){return this.disposable.isDisposed},$a.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var _a=T.Scheduler=function(){function a(a,b,c,d){this.now=a,this._schedule=b,this._scheduleRelative=c,this._scheduleAbsolute=d}function b(a,b){return b(),Wa}var c=a.prototype;return c.schedule=function(a){return this._schedule(a,b)},c.scheduleWithState=function(a,b){return this._schedule(a,b)},c.scheduleWithRelative=function(a,c){return this._scheduleRelative(c,a,b)},c.scheduleWithRelativeAndState=function(a,b,c){return this._scheduleRelative(a,b,c)},c.scheduleWithAbsolute=function(a,c){return this._scheduleAbsolute(c,a,b)},c.scheduleWithAbsoluteAndState=function(a,b,c){return this._scheduleAbsolute(a,b,c)},a.now=X,a.normalize=function(a){return 0>a&&(a=0),a},a}(),ab=_a.normalize;!function(a){function b(a,b){var c=b.first,d=b.second,e=new Sa,f=function(b){d(b,function(b){var c=!1,d=!1,g=a.scheduleWithState(b,function(a,b){return c?e.remove(g):d=!0,f(b),Wa});d||(e.add(g),c=!0)})};return f(c),e}function c(a,b,c){var d=b.first,e=b.second,f=new Sa,g=function(b){e(b,function(b,d){var e=!1,h=!1,i=a[c](b,d,function(a,b){return e?f.remove(i):h=!0,g(b),Wa});h||(f.add(i),e=!0)})};return g(d),f}function d(a,b){a(function(c){b(a,c)})}a.scheduleRecursive=function(a){return this.scheduleRecursiveWithState(a,function(a,b){a(function(){b(a)})})},a.scheduleRecursiveWithState=function(a,c){return this.scheduleWithState({first:a,second:c},b)},a.scheduleRecursiveWithRelative=function(a,b){return this.scheduleRecursiveWithRelativeAndState(b,a,d)},a.scheduleRecursiveWithRelativeAndState=function(a,b,d){return this._scheduleRelative({first:a,second:d},b,function(a,b){return c(a,b,"scheduleWithRelativeAndState")})},a.scheduleRecursiveWithAbsolute=function(a,b){return this.scheduleRecursiveWithAbsoluteAndState(b,a,d)},a.scheduleRecursiveWithAbsoluteAndState=function(a,b,d){return this._scheduleAbsolute({first:a,second:d},b,function(a,b){return c(a,b,"scheduleWithAbsoluteAndState")})}}(_a.prototype),function(){_a.prototype.schedulePeriodic=function(a,b){return this.schedulePeriodicWithState(null,a,b)},_a.prototype.schedulePeriodicWithState=function(a,b,c){if("undefined"==typeof O.setInterval)throw new Error("Periodic scheduling not supported.");var d=a,e=O.setInterval(function(){d=c(d)},b);return Va(function(){O.clearInterval(e)})}}(_a.prototype),function(a){a.catchError=a["catch"]=function(a){return new ib(this,a)}}(_a.prototype);var bb,cb=(T.internals.SchedulePeriodicRecursive=function(){function a(a,b){b(0,this._period);try{this._state=this._action(this._state)}catch(c){throw this._cancel.dispose(),c}}function b(a,b,c,d){this._scheduler=a,this._state=b,this._period=c,this._action=d}return b.prototype.start=function(){var b=new Xa;return this._cancel=b,b.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,a.bind(this))),b},b}(),_a.immediate=function(){function a(a,b){return b(this,a)}function b(a,b,c){for(var d=this.now()+ab(b);d-this.now()>0;);return c(this,a)}function c(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}return new _a(X,a,b,c)}()),db=_a.currentThread=function(){function a(a){for(;a.length>0;){var b=a.dequeue();if(!b.isCancelled()){for(;b.dueTime-_a.now()>0;);!b.isCancelled()&&b.invoke()}}}function b(a,b){return this.scheduleWithRelativeAndState(a,0,b)}function c(b,c,d){var f=this.now()+_a.normalize(c),g=new $a(this,b,d,f);if(e)e.enqueue(g);else{e=new Qa(4),e.enqueue(g);try{a(e)}catch(h){throw h}finally{e=null}}return g.disposable}function d(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}var e,f=new _a(X,b,c,d);return f.scheduleRequired=function(){return!e},f.ensureTrampoline=function(a){e?a():this.schedule(a)},f}(),eb=U,fb=function(){var a,b=U;if("WScript"in this)a=function(a,b){WScript.Sleep(b),a()};else{if(!O.setTimeout)throw new Error("No concurrency detected!");a=O.setTimeout,b=O.clearTimeout}return{setTimeout:a,clearTimeout:b}}(),gb=fb.setTimeout,hb=fb.clearTimeout;!function(){function a(){if(!O.postMessage||O.importScripts)return!1;var a=!1,b=O.onmessage;return O.onmessage=function(){a=!0},O.postMessage("","*"),O.onmessage=b,a}var b=RegExp("^"+String(Aa).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),c="function"==typeof(c=S&&R&&S.setImmediate)&&!b.test(c)&&c,d="function"==typeof(d=S&&R&&S.clearImmediate)&&!b.test(d)&&d;if("function"==typeof c)bb=c,eb=d;else if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))bb=process.nextTick;else if(a()){var e="ms.rx.schedule"+Math.random(),f={},g=0,h=function(a){if("string"==typeof a.data&&a.data.substring(0,e.length)===e){var b=a.data.substring(e.length),c=f[b];c(),delete f[b]}};O.addEventListener?O.addEventListener("message",h,!1):O.attachEvent("onmessage",h,!1),bb=function(a){var b=g++;f[b]=a,O.postMessage(e+b,"*")}}else if(O.MessageChannel){var i=new O.MessageChannel,j={},k=0;i.port1.onmessage=function(a){var b=a.data,c=j[b];c(),delete j[b]},bb=function(a){var b=k++;j[b]=a,i.port2.postMessage(b)}}else"document"in O&&"onreadystatechange"in O.document.createElement("script")?bb=function(a){var b=O.document.createElement("script");b.onreadystatechange=function(){a(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},O.document.documentElement.appendChild(b)}:(bb=function(a){return gb(a,0)},eb=hb)}();var ib=(_a.timeout=function(){function a(a,b){var c=this,d=new Xa,e=bb(function(){d.isDisposed||d.setDisposable(b(c,a))});return new Sa(d,Va(function(){eb(e)}))}function b(a,b,c){var d=this,e=_a.normalize(b);if(0===e)return d.scheduleWithState(a,c);var f=new Xa,g=gb(function(){f.isDisposed||f.setDisposable(c(d,a))},e);return new Sa(f,Va(function(){hb(g)}))}function c(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}return new _a(X,a,b,c)}(),function(a){function b(a,b){return this._scheduler.scheduleWithState(a,this._wrap(b))}function c(a,b,c){return this._scheduler.scheduleWithRelativeAndState(a,b,this._wrap(c))}function d(a,b,c){return this._scheduler.scheduleWithAbsoluteAndState(a,b,this._wrap(c))}function e(e,f){this._scheduler=e,this._handler=f,this._recursiveOriginal=null,this._recursiveWrapper=null,a.call(this,this._scheduler.now.bind(this._scheduler),b,c,d)}return Na(e,a),e.prototype._clone=function(a){return new e(a,this._handler)},e.prototype._wrap=function(a){var b=this;return function(c,d){try{return a(b._getRecursiveWrapper(c),d)}catch(e){if(!b._handler(e))throw e;return Wa}}},e.prototype._getRecursiveWrapper=function(a){if(this._recursiveOriginal!==a){this._recursiveOriginal=a;var b=this._clone(a);b._recursiveOriginal=a,b._recursiveWrapper=b,this._recursiveWrapper=b}return this._recursiveWrapper},e.prototype.schedulePeriodicWithState=function(a,b,c){var d=this,e=!1,f=new Xa;return f.setDisposable(this._scheduler.schedulePeriodicWithState(a,b,function(a){if(e)return null;try{return c(a)}catch(b){if(e=!0,!d._handler(b))throw b;return f.dispose(),null}})),f},e}(_a)),jb=T.Notification=function(){function a(a,b){this.hasValue=null==b?!1:b,this.kind=a}return a.prototype.accept=function(a,b,c){return a&&"object"==typeof a?this._acceptObservable(a):this._accept(a,b,c)},a.prototype.toObservable=function(a){var b=this;return V(a)||(a=cb),new Tb(function(c){return a.schedule(function(){b._acceptObservable(c),"N"===b.kind&&c.onCompleted()})})},a}(),kb=jb.createOnNext=function(){function a(a){return a(this.value)}function b(a){return a.onNext(this.value)}function c(){return"OnNext("+this.value+")"}return function(d){var e=new jb("N",!0);return e.value=d,e._accept=a,e._acceptObservable=b,e.toString=c,e}}(),lb=jb.createOnError=function(){function a(a,b){return b(this.exception)}function b(a){return a.onError(this.exception)}function c(){return"OnError("+this.exception+")"}return function(d){var e=new jb("E");return e.exception=d,e._accept=a,e._acceptObservable=b,e.toString=c,e}}(),mb=jb.createOnCompleted=function(){function a(a,b,c){return c()}function b(a){return a.onCompleted()}function c(){return"OnCompleted()"}return function(){var d=new jb("C");return d._accept=a,d._acceptObservable=b,d.toString=c,d}}(),nb=T.internals.Enumerator=function(a){this._next=a};nb.prototype.next=function(){return this._next()},nb.prototype[ia]=function(){return this};var ob=T.internals.Enumerable=function(a){this._iterator=a};ob.prototype[ia]=function(){return this._iterator()},ob.prototype.concat=function(){var a=this;return new Tb(function(b){var c,d=a[ia](),e=new Ya,f=cb.scheduleRecursive(function(a){if(!c){try{var f=d.next()}catch(g){return b.onError(g)}if(f.done)return b.onCompleted();var h=f.value;_(h)&&(h=Bb(h));var i=new Xa;e.setDisposable(i),i.setDisposable(h.subscribe(function(a){b.onNext(a)},function(a){b.onError(a)},a))}});return new Sa(e,f,Va(function(){c=!0}))})},ob.prototype.catchError=function(){var a=this;return new Tb(function(b){var c,d=a[ia](),e=new Ya,f=cb.scheduleRecursiveWithState(null,function(a,f){if(!c){try{var g=d.next()}catch(h){return observer.onError(h)}if(g.done)return void(null!==a?b.onError(a):b.onCompleted());var i=g.value;_(i)&&(i=Bb(i));var j=new Xa;e.setDisposable(j),j.setDisposable(i.subscribe(function(a){b.onNext(a)},f,function(){b.onCompleted()}))}});return new Sa(e,f,Va(function(){c=!0}))})},ob.prototype.catchErrorWhen=function(a){var b=this;return new Tb(function(c){var d,e,f=new Wb,g=new Wb,h=a(f),i=h.subscribe(g),j=b[ia](),k=new Ya,l=cb.scheduleRecursive(function(a){if(!d){try{var b=j.next()}catch(h){return c.onError(h)}if(b.done)return void(e?c.onError(e):c.onCompleted());var i=b.value;_(i)&&(i=Bb(i));var l=new Xa,m=new Xa;k.setDisposable(new Sa(m,l)),l.setDisposable(i.subscribe(function(a){c.onNext(a)},function(b){m.setDisposable(g.subscribe(a,function(a){c.onError(a)},function(){c.onCompleted()})),f.onNext(b)},function(){c.onCompleted()}))}});return new Sa(i,k,l,Va(function(){d=!0}))})};var pb=ob.repeat=function(a,b){return null==b&&(b=-1),new ob(function(){var c=b;return new nb(function(){return 0===c?ja:(c>0&&c--,{done:!1,value:a})})})},qb=ob.of=function(a,b,c){if(b)var d=na(b,c,3);return new ob(function(){var c=-1;return new nb(function(){return++c<a.length?{done:!1,value:b?d(a[c],c,a):a[c]}:ja})})},rb=T.Observer=function(){};rb.prototype.toNotifier=function(){var a=this;return function(b){return b.accept(a)}},rb.prototype.asObserver=function(){return new vb(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))},rb.prototype.checked=function(){return new wb(this)};var sb=rb.create=function(a,b,c){return a||(a=U),b||(b=$),c||(c=U),new vb(a,b,c)};rb.fromNotifier=function(a,b){return new vb(function(c){return a.call(b,kb(c))},function(c){return a.call(b,lb(c))},function(){return a.call(b,mb())})},rb.prototype.notifyOn=function(a){return new yb(a,this)},rb.prototype.makeSafe=function(a){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,a)};var tb,ub=T.internals.AbstractObserver=function(a){function b(){this.isStopped=!1,a.call(this)}return Na(b,a),b.prototype.onNext=function(a){this.isStopped||this.next(a)},b.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.error(a))},b.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},b.prototype.dispose=function(){this.isStopped=!0},b.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.error(a),!0)},b}(rb),vb=T.AnonymousObserver=function(a){function b(b,c,d){a.call(this),this._onNext=b,this._onError=c,this._onCompleted=d}return Na(b,a),b.prototype.next=function(a){this._onNext(a)},b.prototype.error=function(a){this._onError(a)},b.prototype.completed=function(){this._onCompleted()},b}(ub),wb=function(a){function b(b){a.call(this),this._observer=b,this._state=0}Na(b,a);var c=b.prototype;return c.onNext=function(a){this.checkAccess();try{this._observer.onNext(a)}catch(b){throw b}finally{this._state=0}},c.onError=function(a){this.checkAccess();try{this._observer.onError(a)}catch(b){throw b}finally{this._state=2}},c.onCompleted=function(){this.checkAccess();try{this._observer.onCompleted()}catch(a){throw a}finally{this._state=2}},c.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},b}(rb),xb=T.internals.ScheduledObserver=function(a){function b(b,c){a.call(this),this.scheduler=b,this.observer=c,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new Ya}return Na(b,a),b.prototype.next=function(a){var b=this;this.queue.push(function(){b.observer.onNext(a)})},b.prototype.error=function(a){var b=this;this.queue.push(function(){b.observer.onError(a)})},b.prototype.completed=function(){var a=this;this.queue.push(function(){a.observer.onCompleted()})},b.prototype.ensureActive=function(){var a=!1,b=this;!this.hasFaulted&&this.queue.length>0&&(a=!this.isAcquired,this.isAcquired=!0),a&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(a){var c;if(!(b.queue.length>0))return void(b.isAcquired=!1);c=b.queue.shift();try{c()}catch(d){throw b.queue=[],b.hasFaulted=!0,d}a()}))},b.prototype.dispose=function(){a.prototype.dispose.call(this),this.disposable.dispose()},b}(ub),yb=function(a){function b(b,c,d){a.call(this,b,c),this._cancel=d}return Na(b,a),b.prototype.next=function(b){a.prototype.next.call(this,b),this.ensureActive()},b.prototype.error=function(b){a.prototype.error.call(this,b),this.ensureActive()},b.prototype.completed=function(){a.prototype.completed.call(this),this.ensureActive()},b.prototype.dispose=function(){a.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},b}(xb),zb=T.Observable=function(){function a(a){if(T.config.longStackSupport&&da){try{throw new Error}catch(b){this.stack=b.stack.substring(b.stack.indexOf("\n")+1)}var c=this;this._subscribe=function(b){var e=b.onError.bind(b);return b.onError=function(a){d(a,c),e(a)},a.call(c,b)}}else this._subscribe=a}return tb=a.prototype,tb.subscribe=tb.forEach=function(a,b,c){return this._subscribe("object"==typeof a?a:sb(a,b,c))},tb.subscribeOnNext=function(a,b){return this._subscribe(sb("undefined"!=typeof b?function(c){a.call(b,c)}:a))},tb.subscribeOnError=function(a,b){return this._subscribe(sb(null,"undefined"!=typeof b?function(c){a.call(b,c)}:a))},tb.subscribeOnCompleted=function(a,b){return this._subscribe(sb(null,null,"undefined"!=typeof b?function(){a.call(b)}:a))},a}(),Ab=T.ObservableBase=function(a){function b(a){return a&&"function"==typeof a.dispose?a:"function"==typeof a?Va(a):Wa}function c(a,c){var d=c[0],e=c[1];try{d.setDisposable(b(e.subscribeCore(d)))}catch(f){if(!d.fail(f))throw f}}function d(a){var b=new Ub(a),d=[b,this];return db.scheduleRequired()?db.scheduleWithState(d,c):c(null,d),b}function e(){a.call(this,d)}return Na(e,a),e.prototype.subscribeCore=function(){throw new Error("Not implemeneted")},e}(zb);tb.observeOn=function(a){var b=this;return new Tb(function(c){return b.subscribe(new yb(a,c))},b)},tb.subscribeOn=function(a){var b=this;return new Tb(function(c){var d=new Xa,e=new Ya;return e.setDisposable(d),d.setDisposable(a.schedule(function(){e.setDisposable(new r(a,b.subscribe(c)))})),e},b)};var Bb=zb.fromPromise=function(a){return Cb(function(){var b=new T.AsyncSubject;return a.then(function(a){b.onNext(a),b.onCompleted()},b.onError.bind(b)),b})};tb.toPromise=function(a){if(a||(a=T.config.Promise),!a)throw new TypeError("Promise type not provided nor in Rx.config.Promise");var b=this;return new a(function(a,c){var d,e=!1;b.subscribe(function(a){d=a,e=!0},c,function(){e&&a(d)})})},tb.toArray=function(){var a=this;return new Tb(function(b){var c=[];return a.subscribe(function(a){c.push(a)},function(a){b.onError(a)},function(){b.onNext(c),b.onCompleted()})},a)},zb.create=zb.createWithDisposable=function(a,b){return new Tb(a,b)};var Cb=zb.defer=function(a){return new Tb(function(b){var c;try{c=a()}catch(d){return Lb(d).subscribe(b)}return _(c)&&(c=Bb(c)),c.subscribe(b)})},Db=zb.empty=function(a){return V(a)||(a=cb),new Tb(function(b){return a.schedule(function(){b.onCompleted()})})},Eb=Math.pow(2,53)-1;u.prototype[ia]=function(){return new v(this._s)},v.prototype[ia]=function(){return this},v.prototype.next=function(){if(this._i<this._l){var a=this._s.charAt(this._i++);return{done:!1,value:a}}return ja},w.prototype[ia]=function(){return new x(this._a)},x.prototype[ia]=function(){return this},x.prototype.next=function(){if(this._i<this._l){var a=this._a[this._i++];return{done:!1,value:a}}return ja};var Fb=zb.from=function(a,b,c,d){if(null==a)throw new Error("iterable cannot be null.");if(b&&!aa(b))throw new Error("mapFn when provided must be a function");if(b)var e=na(b,c,2);V(d)||(d=db);var f=Object(a),g=z(f);return new Tb(function(a){return d.scheduleRecursiveWithState(0,function(b,c){try{var d=g.next()}catch(f){return void a.onError(f)}if(d.done)return void a.onCompleted();var h=d.value;if(e)try{h=e(h,b)}catch(f){return void a.onError(f)}a.onNext(h),c(b+1)})})},Gb=function(a){function b(b,c){this.args=b,this.scheduler=c||db,a.call(this)}return Na(b,a),b.prototype.subscribeCore=function(a){var b=new Hb(a,this);return b.run()},b}(Ab),Hb=function(){function a(a,b){this.observer=a,this.parent=b}function b(a,b){a.i<a.len?(a.observer.onNext(a.args[a.i++]),b(a)):a.observer.onCompleted()}return a.prototype.run=function(){return this.parent.scheduler.scheduleRecursiveWithState({i:0,args:this.parent.args,len:this.parent.args.length,observer:this.observer},b)},a}(),Ib=zb.fromArray=function(a,b){return new Gb(a,b)};zb.generate=function(a,b,c,d,e){return V(e)||(e=db),new Tb(function(f){var g=!0,h=a;return e.scheduleRecursive(function(a){var e,i;try{g?g=!1:h=c(h),e=b(h),e&&(i=d(h))}catch(j){return void f.onError(j)}e?(f.onNext(i),a()):f.onCompleted()})})};var Jb=zb.never=function(){return new Tb(function(){return Wa})};zb.of=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return C(null,a)},zb.ofWithScheduler=function(a){for(var b=[],c=1,d=arguments.length;d>c;c++)b.push(arguments[c]);return C(a,b)},zb.pairs=function(a,b){return b||(b=T.Scheduler.currentThread),new Tb(function(c){var d=Object.keys(a),e=d.length;return b.scheduleRecursiveWithState(0,function(b,f){if(e>b){var g=d[b];c.onNext([g,a[g]]),f(b+1)}else c.onCompleted()})})},zb.range=function(a,b,c){return V(c)||(c=db),new Tb(function(d){return c.scheduleRecursiveWithState(0,function(c,e){b>c?(d.onNext(a+c),e(c+1)):d.onCompleted()})})},zb.repeat=function(a,b,c){return V(c)||(c=db),Kb(a,c).repeat(null==b?-1:b)};var Kb=zb["return"]=zb.just=function(a,b){return V(b)||(b=cb),new Tb(function(c){return b.schedule(function(){c.onNext(a),c.onCompleted()})})};zb.returnValue=function(){return Kb.apply(null,arguments)};var Lb=zb["throw"]=zb.throwError=function(a,b){return V(b)||(b=cb),new Tb(function(c){return b.schedule(function(){c.onError(a)})})};zb.throwException=function(){return zb.throwError.apply(null,arguments)},zb.using=function(a,b){return new Tb(function(c){var d,e,f=Wa;try{d=a(),d&&(f=d),e=b(d)}catch(g){return new Sa(Lb(g).subscribe(c),f)}return new Sa(e.subscribe(c),f)})},tb.amb=function(a){var b=this;return new Tb(function(c){
function d(){f||(f=g,j.dispose())}function e(){f||(f=h,i.dispose())}var f,g="L",h="R",i=new Xa,j=new Xa;return _(a)&&(a=Bb(a)),i.setDisposable(b.subscribe(function(a){d(),f===g&&c.onNext(a)},function(a){d(),f===g&&c.onError(a)},function(){d(),f===g&&c.onCompleted()})),j.setDisposable(a.subscribe(function(a){e(),f===h&&c.onNext(a)},function(a){e(),f===h&&c.onError(a)},function(){e(),f===h&&c.onCompleted()})),new Sa(i,j)})},zb.amb=function(){function a(a,b){return a.amb(b)}var b=Jb(),c=[];if(Array.isArray(arguments[0]))c=arguments[0];else for(var d=0,e=arguments.length;e>d;d++)c.push(arguments[d]);for(var d=0,e=c.length;e>d;d++)b=a(b,c[d]);return b},tb["catch"]=tb.catchError=function(a){return"function"==typeof a?D(this,a):Mb([this,a])},tb.catchException=function(a){return this.catchError(a)};var Mb=zb.catchError=zb["catch"]=zb.catchException=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return qb(a).catchError()};tb.combineLatest=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return Array.isArray(a[0])?a[0].unshift(this):a.unshift(this),Nb.apply(this,a)};var Nb=zb.combineLatest=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);var d=a.pop();return Array.isArray(a[0])&&(a=a[0]),new Tb(function(b){function c(a){var c;if(h[a]=!0,i||(i=h.every(W))){try{c=d.apply(null,k)}catch(e){return void b.onError(e)}b.onNext(c)}else j.filter(function(b,c){return c!==a}).every(W)&&b.onCompleted()}function e(a){j[a]=!0,j.every(W)&&b.onCompleted()}for(var f=function(){return!1},g=a.length,h=p(g,f),i=!1,j=p(g,f),k=new Array(g),l=new Array(g),m=0;g>m;m++)!function(d){var f=a[d],g=new Xa;_(f)&&(f=Bb(f)),g.setDisposable(f.subscribe(function(a){k[d]=a,c(d)},function(a){b.onError(a)},function(){e(d)})),l[d]=g}(m);return new Sa(l)},this)};tb.concat=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return a.unshift(this),Ob.apply(null,a)};var Ob=zb.concat=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return qb(a).concat()};tb.concatAll=tb.concatObservable=function(){return this.merge(1)},tb.merge=function(a){if("number"!=typeof a)return Pb(this,a);var b=this;return new Tb(function(c){function d(a){var b=new Xa;f.add(b),_(a)&&(a=Bb(a)),b.setDisposable(a.subscribe(function(a){c.onNext(a)},function(a){c.onError(a)},function(){f.remove(b),h.length>0?d(h.shift()):(e--,g&&0===e&&c.onCompleted())}))}var e=0,f=new Sa,g=!1,h=[];return f.add(b.subscribe(function(b){a>e?(e++,d(b)):h.push(b)},function(a){c.onError(a)},function(){g=!0,0===e&&c.onCompleted()})),f},b)};var Pb=zb.merge=function(){var a,b,c=[],d=arguments.length;if(arguments[0])if(V(arguments[0]))for(a=arguments[0],b=1;d>b;b++)c.push(arguments[b]);else for(a=cb,b=0;d>b;b++)c.push(arguments[b]);else for(a=cb,b=1;d>b;b++)c.push(arguments[b]);return Array.isArray(c[0])&&(c=c[0]),C(a,c).mergeAll()};tb.mergeAll=function(){var a=this;return new Tb(function(b){var c=new Sa,d=!1,e=new Xa;return c.add(e),e.setDisposable(a.subscribe(function(a){var e=new Xa;c.add(e),_(a)&&(a=Bb(a)),e.setDisposable(a.subscribe(function(a){b.onNext(a)},function(a){b.onError(a)},function(){c.remove(e),d&&1===c.length&&b.onCompleted()}))},function(a){b.onError(a)},function(){d=!0,1===c.length&&b.onCompleted()})),c},a)},tb.mergeObservable=function(){return this.mergeAll.apply(this,arguments)},tb.onErrorResumeNext=function(a){if(!a)throw new Error("Second observable is required");return Qb([this,a])};var Qb=zb.onErrorResumeNext=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return new Tb(function(b){var c=0,d=new Ya,e=cb.scheduleRecursive(function(e){var f,g;c<a.length?(f=a[c++],_(f)&&(f=Bb(f)),g=new Xa,d.setDisposable(g),g.setDisposable(f.subscribe(b.onNext.bind(b),e,e))):b.onCompleted()});return new Sa(d,e)})};tb.skipUntil=function(a){var b=this;return new Tb(function(c){var d=!1,e=new Sa(b.subscribe(function(a){d&&c.onNext(a)},function(a){c.onError(a)},function(){d&&c.onCompleted()}));_(a)&&(a=Bb(a));var f=new Xa;return e.add(f),f.setDisposable(a.subscribe(function(){d=!0,f.dispose()},function(a){c.onError(a)},function(){f.dispose()})),e},b)},tb["switch"]=tb.switchLatest=function(){var a=this;return new Tb(function(b){var c=!1,d=new Ya,e=!1,f=0,g=a.subscribe(function(a){var g=new Xa,h=++f;c=!0,d.setDisposable(g),_(a)&&(a=Bb(a)),g.setDisposable(a.subscribe(function(a){f===h&&b.onNext(a)},function(a){f===h&&b.onError(a)},function(){f===h&&(c=!1,e&&b.onCompleted())}))},function(a){b.onError(a)},function(){e=!0,!c&&b.onCompleted()});return new Sa(g,d)},a)},tb.takeUntil=function(a){var b=this;return new Tb(function(c){return _(a)&&(a=Bb(a)),new Sa(b.subscribe(c),a.subscribe(function(){c.onCompleted()},function(a){c.onError(a)},U))},b)},tb.withLatestFrom=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);var d=a.pop(),e=this;if("undefined"==typeof e)throw new Error("Source observable not found for withLatestFrom().");if("function"!=typeof d)throw new Error("withLatestFrom() expects a resultSelector function.");return Array.isArray(a[0])&&(a=a[0]),new Tb(function(b){for(var c=function(){return!1},f=a.length,g=p(f,c),h=!1,i=new Array(f),j=new Array(f+1),k=0;f>k;k++)!function(c){var d=a[c],e=new Xa;_(d)&&(d=Bb(d)),e.setDisposable(d.subscribe(function(a){i[c]=a,g[c]=!0,h=g.every(W)},b.onError.bind(b),function(){})),j[c]=e}(k);var l=new Xa;return l.setDisposable(e.subscribe(function(a){var c,e=[a].concat(i);if(h){try{c=d.apply(null,e)}catch(f){return void b.onError(f)}b.onNext(c)}},b.onError.bind(b),function(){b.onCompleted()})),j[f]=l,new Sa(j)},this)},tb.zip=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);if(Array.isArray(a[0]))return E.apply(this,a);var d=this,e=a.pop();return a.unshift(d),new Tb(function(b){function c(a){var c,f;if(h.every(function(a){return a.length>0})){try{f=h.map(function(a){return a.shift()}),c=e.apply(d,f)}catch(g){return void b.onError(g)}b.onNext(c)}else i.filter(function(b,c){return c!==a}).every(W)&&b.onCompleted()}function f(a){i[a]=!0,i.every(function(a){return a})&&b.onCompleted()}for(var g=a.length,h=p(g,G),i=p(g,F),j=new Array(g),k=0;g>k;k++)!function(d){var e=a[d],g=new Xa;_(e)&&(e=Bb(e)),g.setDisposable(e.subscribe(function(a){h[d].push(a),c(d)},function(a){b.onError(a)},function(){f(d)})),j[d]=g}(k);return new Sa(j)},d)},zb.zip=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);var d=a.shift();return d.zip.apply(d,a)},zb.zipArray=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return new Tb(function(b){function c(a){if(f.every(function(a){return a.length>0})){var c=f.map(function(a){return a.shift()});b.onNext(c)}else if(g.filter(function(b,c){return c!==a}).every(W))return void b.onCompleted()}function d(a){return g[a]=!0,g.every(W)?void b.onCompleted():void 0}for(var e=a.length,f=p(e,function(){return[]}),g=p(e,function(){return!1}),h=new Array(e),i=0;e>i;i++)!function(e){h[e]=new Xa,h[e].setDisposable(a[e].subscribe(function(a){f[e].push(a),c(e)},function(a){b.onError(a)},function(){d(e)}))}(i);return new Sa(h)})},tb.asObservable=function(){var a=this;return new Tb(function(b){return a.subscribe(b)},this)},tb.bufferWithCount=function(a,b){return"number"!=typeof b&&(b=a),this.windowWithCount(a,b).selectMany(function(a){return a.toArray()}).where(function(a){return a.length>0})},tb.dematerialize=function(){var a=this;return new Tb(function(b){return a.subscribe(function(a){return a.accept(b)},function(a){b.onError(a)},function(){b.onCompleted()})},this)},tb.distinctUntilChanged=function(a,b){var c=this;return b||(b=Y),new Tb(function(d){var e,f=!1;return c.subscribe(function(c){var g=c;if(a)try{g=a(c)}catch(h){return void d.onError(h)}if(f)try{var i=b(e,g)}catch(h){return void d.onError(h)}f&&i||(f=!0,e=g,d.onNext(c))},function(a){d.onError(a)},function(){d.onCompleted()})},this)},tb["do"]=tb.tap=tb.doAction=function(a,b,c){var d=this,e="function"==typeof a||"undefined"==typeof a?sb(a||U,b||U,c||U):a;return new Tb(function(a){return d.subscribe(function(b){try{e.onNext(b)}catch(c){a.onError(c)}a.onNext(b)},function(b){try{e.onError(b)}catch(c){a.onError(c)}a.onError(b)},function(){try{e.onCompleted()}catch(b){a.onError(b)}a.onCompleted()})},this)},tb.doOnNext=tb.tapOnNext=function(a,b){return this.tap("undefined"!=typeof b?function(c){a.call(b,c)}:a)},tb.doOnError=tb.tapOnError=function(a,b){return this.tap(U,"undefined"!=typeof b?function(c){a.call(b,c)}:a)},tb.doOnCompleted=tb.tapOnCompleted=function(a,b){return this.tap(U,null,"undefined"!=typeof b?function(){a.call(b)}:a)},tb["finally"]=tb.ensure=function(a){var b=this;return new Tb(function(c){var d;try{d=b.subscribe(c)}catch(e){throw a(),e}return Va(function(){try{d.dispose()}catch(b){throw b}finally{a()}})},this)},tb.finallyAction=function(a){return this.ensure(a)},tb.ignoreElements=function(){var a=this;return new Tb(function(b){return a.subscribe(U,function(a){b.onError(a)},function(){b.onCompleted()})},a)},tb.materialize=function(){var a=this;return new Tb(function(b){return a.subscribe(function(a){b.onNext(kb(a))},function(a){b.onNext(lb(a)),b.onCompleted()},function(){b.onNext(mb()),b.onCompleted()})},a)},tb.repeat=function(a){return pb(this,a).concat()},tb.retry=function(a){return pb(this,a).catchError()},tb.retryWhen=function(a){return pb(this).catchErrorWhen(a)},tb.scan=function(){var a,b,c=!1,d=this;return 2===arguments.length?(c=!0,a=arguments[0],b=arguments[1]):b=arguments[0],new Tb(function(e){var f,g,h;return d.subscribe(function(d){!h&&(h=!0);try{f?g=b(g,d):(g=c?b(a,d):d,f=!0)}catch(i){return void e.onError(i)}e.onNext(g)},function(a){e.onError(a)},function(){!h&&c&&e.onNext(a),e.onCompleted()})},d)},tb.skipLast=function(a){var b=this;return new Tb(function(c){var d=[];return b.subscribe(function(b){d.push(b),d.length>a&&c.onNext(d.shift())},function(a){c.onError(a)},function(){c.onCompleted()})},b)},tb.startWith=function(){var a,b=0;arguments.length&&V(arguments[0])?(a=arguments[0],b=1):a=cb;for(var c=[],d=b,e=arguments.length;e>d;d++)c.push(arguments[d]);return qb([Ib(c,a),this]).concat()},tb.takeLast=function(a){var b=this;return new Tb(function(c){var d=[];return b.subscribe(function(b){d.push(b),d.length>a&&d.shift()},function(a){c.onError(a)},function(){for(;d.length>0;)c.onNext(d.shift());c.onCompleted()})},b)},tb.takeLastBuffer=function(a){var b=this;return new Tb(function(c){var d=[];return b.subscribe(function(b){d.push(b),d.length>a&&d.shift()},function(a){c.onError(a)},function(){c.onNext(d),c.onCompleted()})},b)},tb.windowWithCount=function(a,b){var c=this;if(+a||(a=0),1/0===Math.abs(a)&&(a=0),0>=a)throw new Error(ba);if(null==b&&(b=a),+b||(b=0),1/0===Math.abs(b)&&(b=0),0>=b)throw new Error(ba);return new Tb(function(d){function e(){var a=new Wb;i.push(a),d.onNext(Pa(a,g))}var f=new Xa,g=new Za(f),h=0,i=[];return e(),f.setDisposable(c.subscribe(function(c){for(var d=0,f=i.length;f>d;d++)i[d].onNext(c);var g=h-a+1;g>=0&&g%b===0&&i.shift().onCompleted(),++h%b===0&&e()},function(a){for(;i.length>0;)i.shift().onError(a);d.onError(a)},function(){for(;i.length>0;)i.shift().onCompleted();d.onCompleted()})),g},c)},tb.selectConcat=tb.concatMap=function(a,b,c){return aa(a)&&aa(b)?this.concatMap(function(c,d){var e=a(c,d);return _(e)&&(e=Bb(e)),(la(e)||ka(e))&&(e=Fb(e)),e.map(function(a,e){return b(c,a,d,e)})}):aa(a)?H(this,a,c):H(this,function(){return a})},tb.concatMapObserver=tb.selectConcatObserver=function(a,b,c,d){var e=this,f=na(a,d,2),g=na(b,d,1),h=na(c,d,0);return new Tb(function(a){var b=0;return e.subscribe(function(c){var d;try{d=f(c,b++)}catch(e){return void a.onError(e)}_(d)&&(d=Bb(d)),a.onNext(d)},function(b){var c;try{c=g(b)}catch(d){return void a.onError(d)}_(c)&&(c=Bb(c)),a.onNext(c),a.onCompleted()},function(){var b;try{b=h()}catch(c){return void a.onError(c)}_(b)&&(b=Bb(b)),a.onNext(b),a.onCompleted()})},this).concatAll()},tb.defaultIfEmpty=function(b){var c=this;return b===a&&(b=null),new Tb(function(a){var d=!1;return c.subscribe(function(b){d=!0,a.onNext(b)},function(b){a.onError(b)},function(){!d&&a.onNext(b),a.onCompleted()})},c)},J.prototype.push=function(a){var b=-1===I(this.set,a,this.comparer);return b&&this.set.push(a),b},tb.distinct=function(a,b){var c=this;return b||(b=Y),new Tb(function(d){var e=new J(b);return c.subscribe(function(b){var c=b;if(a)try{c=a(b)}catch(f){return void d.onError(f)}e.push(c)&&d.onNext(b)},function(a){d.onError(a)},function(){d.onCompleted()})},this)};var Rb=function(a){function b(b,c,d){this.source=b,this.selector=na(c,d,3),a.call(this)}return Na(b,a),b.prototype.internalMap=function(a,c){var d=this;return new b(this.source,function(b,c,e){return a(d.selector(b,c,e),c,e)},c)},b.prototype.subscribeCore=function(a){return this.source.subscribe(new K(a,this.selector,this))},b}(Ab);K.prototype.onNext=function(a){if(!this.isStopped){try{var b=this.selector(a,this.index++,this.source)}catch(c){return this.observer.onError(c)}this.observer.onNext(b)}},K.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.observer.onError(a))},K.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.observer.onCompleted())},K.prototype.dispose=function(){this.isStopped=!0},K.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(a),!0)},tb.map=tb.select=function(a,b){var c="function"==typeof a?a:function(){return a};return this instanceof Rb?this.internalMap(a,b):new Rb(this,c,b)},tb.pluck=function(){var b=arguments,c=arguments.length;if(0===c)throw new Error("List of properties cannot be empty.");return this.map(function(d){for(var e=d,f=0;c>f;f++){var g=e[b[f]];if("undefined"==typeof g)return a;e=g}return e})},tb.flatMapObserver=tb.selectManyObserver=function(a,b,c,d){var e=this;return new Tb(function(f){var g=0;return e.subscribe(function(b){var c;try{c=a.call(d,b,g++)}catch(e){return void f.onError(e)}_(c)&&(c=Bb(c)),f.onNext(c)},function(a){var c;try{c=b.call(d,a)}catch(e){return void f.onError(e)}_(c)&&(c=Bb(c)),f.onNext(c),f.onCompleted()},function(){var a;try{a=c.call(d)}catch(b){return void f.onError(b)}_(a)&&(a=Bb(a)),f.onNext(a),f.onCompleted()})},e).mergeAll()},tb.selectMany=tb.flatMap=function(a,b,c){return aa(a)&&aa(b)?this.flatMap(function(c,d){var e=a(c,d);return _(e)&&(e=Bb(e)),(la(e)||ka(e))&&(e=Fb(e)),e.map(function(a,e){return b(c,a,d,e)})},c):aa(a)?L(this,a,c):L(this,function(){return a})},tb.selectSwitch=tb.flatMapLatest=tb.switchMap=function(a,b){return this.select(a,b).switchLatest()},tb.skip=function(a){if(0>a)throw new Error(ba);var b=this;return new Tb(function(c){var d=a;return b.subscribe(function(a){0>=d?c.onNext(a):d--},function(a){c.onError(a)},function(){c.onCompleted()})},b)},tb.skipWhile=function(a,b){var c=this,d=na(a,b,3);return new Tb(function(a){var b=0,e=!1;return c.subscribe(function(f){if(!e)try{e=!d(f,b++,c)}catch(g){return void a.onError(g)}e&&a.onNext(f)},function(b){a.onError(b)},function(){a.onCompleted()})},c)},tb.take=function(a,b){if(0>a)throw new RangeError(ba);if(0===a)return Db(b);var c=this;return new Tb(function(b){var d=a;return c.subscribe(function(a){d-->0&&(b.onNext(a),0===d&&b.onCompleted())},function(a){b.onError(a)},function(){b.onCompleted()})},c)},tb.takeWhile=function(a,b){var c=this,d=na(a,b,3);return new Tb(function(a){var b=0,e=!0;return c.subscribe(function(f){if(e){try{e=d(f,b++,c)}catch(g){return void a.onError(g)}e?a.onNext(f):a.onCompleted()}},function(b){a.onError(b)},function(){a.onCompleted()})},c)};var Sb=function(a){function b(b,c,d){this.source=b,this.predicate=na(c,d,3),a.call(this)}return Na(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new M(a,this.predicate,this))},b.prototype.internalFilter=function(a,c){var d=this;return new b(this.source,function(b,c,e){return d.predicate(b,c,e)&&a(b,c,e)},c)},b}(Ab);M.prototype.onNext=function(a){try{var b=this.predicate(a,this.index++,this.source)}catch(c){return this.observer.onError(c)}b&&this.observer.onNext(a)},M.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.observer.onError(a))},M.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.observer.onCompleted())},M.prototype.dispose=function(){this.isStopped=!0},M.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(a),!0)},tb.filter=tb.where=function(a,b){return this instanceof Sb?this.internalFilter(a,b):new Sb(this,a,b)},tb.transduce=function(a){function b(a){return{init:function(){return a},step:function(a,b){return a.onNext(b)},result:function(a){return a.onCompleted()}}}var c=this;return new Tb(function(d){var e=a(b(d));return c.subscribe(function(a){try{e.step(d,a)}catch(b){d.onError(b)}},d.onError.bind(d),function(){e.result(d)})},c)};var Tb=T.AnonymousObservable=function(a){function b(a){return a&&"function"==typeof a.dispose?a:"function"==typeof a?Va(a):Wa}function c(a,c){var d=c[0],e=c[1];try{d.setDisposable(b(e(d)))}catch(f){if(!d.fail(f))throw f}}function d(b,d){function e(a){var d=new Ub(a),e=[d,b];return db.scheduleRequired()?db.scheduleWithState(e,c):c(null,e),d}this.source=d,a.call(this,e)}return Na(d,a),d}(zb),Ub=function(a){function b(b){a.call(this),this.observer=b,this.m=new Xa}Na(b,a);var c=b.prototype;return c.next=function(a){var b=!1;try{this.observer.onNext(a),b=!0}catch(c){throw c}finally{!b&&this.dispose()}},c.error=function(a){try{this.observer.onError(a)}catch(b){throw b}finally{this.dispose()}},c.completed=function(){try{this.observer.onCompleted()}catch(a){throw a}finally{this.dispose()}},c.setDisposable=function(a){this.m.setDisposable(a)},c.getDisposable=function(){return this.m.getDisposable()},c.dispose=function(){a.prototype.dispose.call(this),this.m.dispose()},b}(ub),Vb=function(a,b){this.subject=a,this.observer=b};Vb.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var a=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(a,1),this.observer=null}};var Wb=T.Subject=function(a){function d(a){return b(this),this.isStopped?this.hasError?(a.onError(this.error),Wa):(a.onCompleted(),Wa):(this.observers.push(a),new Vb(this,a))}function e(){a.call(this,d),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}return Na(e,a),Oa(e.prototype,rb.prototype,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(b(this),!this.isStopped){this.isStopped=!0;for(var a=0,d=c(this.observers),e=d.length;e>a;a++)d[a].onCompleted();this.observers.length=0}},onError:function(a){if(b(this),!this.isStopped){this.isStopped=!0,this.error=a,this.hasError=!0;for(var d=0,e=c(this.observers),f=e.length;f>d;d++)e[d].onError(a);this.observers.length=0}},onNext:function(a){if(b(this),!this.isStopped)for(var d=0,e=c(this.observers),f=e.length;f>d;d++)e[d].onNext(a)},dispose:function(){this.isDisposed=!0,this.observers=null}}),e.create=function(a,b){return new Xb(a,b)},e}(zb),Xb=(T.AsyncSubject=function(a){function d(a){return b(this),this.isStopped?(this.hasError?a.onError(this.error):this.hasValue?(a.onNext(this.value),a.onCompleted()):a.onCompleted(),Wa):(this.observers.push(a),new Vb(this,a))}function e(){a.call(this,d),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}return Na(e,a),Oa(e.prototype,rb,{hasObservers:function(){return b(this),this.observers.length>0},onCompleted:function(){var a,d;if(b(this),!this.isStopped){this.isStopped=!0;var e=c(this.observers),d=e.length;if(this.hasValue)for(a=0;d>a;a++){var f=e[a];f.onNext(this.value),f.onCompleted()}else for(a=0;d>a;a++)e[a].onCompleted();this.observers.length=0}},onError:function(a){if(b(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=a;for(var d=0,e=c(this.observers),f=e.length;f>d;d++)e[d].onError(a);this.observers.length=0}},onNext:function(a){b(this),this.isStopped||(this.value=a,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.exception=null,this.value=null}}),e}(zb),T.AnonymousSubject=function(a){function b(a){return this.observable.subscribe(a)}function c(c,d){this.observer=c,this.observable=d,a.call(this,b)}return Na(c,a),Oa(c.prototype,rb.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(a){this.observer.onError(a)},onNext:function(a){this.observer.onNext(a)}}),c}(zb));"function"==typeof define&&"object"==typeof define.amd&&define.amd?(O.Rx=T,define("rx",[],function(){return T})):P&&Q?R?(Q.exports=T).Rx=T:P.Rx=T:O.Rx=T;var Yb=h()}).call(this),define("scalejs.routing-historyjs/history",["scalejs!core","history","rx"],function(a,b,c){"use strict";function d(a){return b.pushState(a.data,a.title,a.url)}function e(){return b.getState()}function f(a){return b.replaceState(a.data,a.title,a.url)}function g(){var a=c.Observable,d=c.Disposable;return a.createWithDisposable(function(a){return b.Adapter.bind(window,"statechange",function(){a.onNext(e())}),d.create(function(){window.onstatechange=null})}).publishValue(e()).refCount()}return{add:d,get:e,replace:f,observe:g}}),define("scalejs.routing-historyjs/routeMapper",["scalejs!core"],function(a){"use strict";var b=a.object.clone;return function(a){function c(){var b,c;f=a.replace(/^\/*|[/?]*$/g,""),b=f.match(/{([^}])*}/g),b&&(h=b.map(function(a){return a.replace(/[{}]/g,"")})),c="^[/]*"+f.replace(/{[^}]*}/g,"(.+?)")+"[?/]*$",g=new RegExp(c)}function d(a){var b,c,d,e,f={};return b=a.split(/\/*\?/),c=b[0],d=a.substring(c.length).replace(/^[?/]*/,""),e=c.match(g),null===e?null:(e.shift(),e.forEach(function(a,b){f[h[b]]=a}),d.split("&").map(function(a){var b=a.split("="),c=b[0],d=b[1];c&&(f[c]=d)}),f)}function e(a){a=a?b(a):{};var c,d={};return c=h.reduce(function(b,c){var d=b.replace("{"+c+"}",a[c]);return delete a[c],d},f),d=Object.keys(a).map(function(b){return b+"="+a[b]}).join("&"),"/"+c+(d?"?"+d:"")}var f,g,h=[];return c(),{fromUrl:d,toUrl:e}}}),define("scalejs.routing-historyjs/router",["./routeMapper"],function(a){"use strict";function b(b,c){var d=a(c);f[b]=d}function c(a,b){var c,d;if(!(b.indexOf(g)<0))return b=b.substring(g.length),c=f[a],c?d=c.fromUrl(b):void 0}function d(a,b){var c,d;return c=f[a],c?(d=c.toUrl(b),g+d):void 0}function e(a){g=a||"",g=g.replace(/\/*$/,"")}var f={},g="";return{addRoute:b,tryToUrl:d,tryFromUrl:c,setBaseUrl:e}}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("scion-ng",b):a.scion=b()}(this,function(){"use strict";function initializeModel(rootState){function generateId(a){void 0===idCount[a]&&(idCount[a]=0);var b=idCount[a]++;return"$generated-"+a+"-"+b}function wrapInFakeRootState(a){return{$deserializeDatamodel:a.$deserializeDatamodel||function(){},$serializeDatamodel:a.$serializeDatamodel||function(){return null},$idToStateMap:idToStateMap,states:[{type:"initial",transitions:[{target:a}]},a]}}function normalizeAction(stateOrTransition,actionProperty){function normalize(o){if("string"==typeof o)return eval(o);if("function"==typeof o)return o;throw new Error("Unrecognized type of object for actionProperty "+actionProperty)}var v=stateOrTransition[actionProperty];void 0!==v&&(stateOrTransition[actionProperty]=Array.isArray(v)?v.map(normalize):[normalize(v)])}function traverse(a,b){if(b.transitions&&transitions.push.apply(transitions,b.transitions),b.id){if(idToStateMap[b.id])throw new Error("Redefinition of state id "+b.id);idToStateMap[b.id]=b}b.type=b.type||"state",b.ancestors=a,b.depth=a.length,b.parent=a[0],b.transitions=b.transitions||[],b.transitions.forEach(function(a){a.documentOrder=documentOrder++,a.source=b});var c=traverse.bind(null,[b].concat(a));switch(b.states&&b.states.forEach(c),b.type){case"parallel":b.typeEnum=STATE_TYPES.PARALLEL;break;case"initial":b.typeEnum=STATE_TYPES.INITIAL;break;case"history":b.typeEnum=STATE_TYPES.HISTORY;break;case"final":b.typeEnum=STATE_TYPES.FINAL;break;case"state":case"scxml":b.states&&b.states.length?b.typeEnum=STATE_TYPES.COMPOSITE:b.typeEnum=STATE_TYPES.BASIC;break;default:throw new Error("Unknown state type: "+b.type)}b.states?b.descendants=b.states.concat(b.states.map(function(a){return a.descendants}).reduce(function(a,b){return a.concat(b)},[])):b.descendants=[];var d;if(b.typeEnum===STATE_TYPES.COMPOSITE&&("string"==typeof b.initial?(d=b.states.filter(function(a){return a.id===b.initial}),d.length&&(b.initialRef=d[0])):(d=b.states.filter(function(a){return"initial"===a.type}),b.initialRef=d.length?d[0]:b.states[0]),!b.initialRef))throw new Error("Unable to locate initial state for composite state: "+b.id);if(b.typeEnum===STATE_TYPES.COMPOSITE||b.typeEnum===STATE_TYPES.PARALLEL){var e=b.states.filter(function(a){return"history"===a.type});b.historyRef=e[0]}b.id||(b.id=generateId(b.type),idToStateMap[b.id]=b),["onEntry","onExit"].forEach(normalizeAction.bind(this,b))}function connectTransitionGraph(){transitions.forEach(function(a){normalizeAction(a,"onTransition")}),transitions.forEach(function(a){a.event&&(a.events=a.event.trim().split(/ +/))}),transitions.forEach(function(a){if(!a.targets&&"undefined"!=typeof a.target)if("string"==typeof a.target){var b=idToStateMap[a.target];if(!b)throw new Error("Unable to find target state with id "+a.target);a.target=b,a.targets=[a.target]}else if(Array.isArray(a.target))a.targets=a.target.map(function(b){if("string"==typeof b){if(b=idToStateMap[b],!b)throw new Error("Unable to find target state with id "+a.target);return b}return b});else{if("object"!=typeof a.target)throw new Error("Transition target has unknown type: "+a.target);a.targets=[a.target]}}),transitions.forEach(function(a){a.targets&&(a.lcca=getLCCA(a.source,a.targets[0])),a.scope=getScope(a)})}function getScope(a){var b="internal"===a.type&&a.source.parent&&a.targets&&a.targets.every(function(b){return a.source.descendants.indexOf(b)>-1});return a.targets?b?a.source:a.lcca:a.source}function getLCCA(a,b){var c=[];if(a.ancestors.forEach(function(a){a.typeEnum===STATE_TYPES.COMPOSITE&&a.descendants.indexOf(b)>-1&&c.push(a)}),!c.length)throw new Error("Could not find LCA for states.");return c[0]}var transitions=[],idToStateMap={},documentOrder=0,idCount={},fakeRootState=wrapInFakeRootState(rootState);return traverse([],fakeRootState),connectTransitionGraph(),fakeRootState}function ArraySet(a){a=a||[],this.o=[],a.forEach(function(a){this.add(a)},this)}function getTransitionWithHigherSourceChildPriority(a){var b=a[0],c=a[1];return b.source.depth<c.source.depth?c:c.source.depth<b.source.depth?b:b.documentOrder<c.documentOrder?b:c}function initializeModelGeneratorFn(a,b,c){b.x=b.x||{};var d=["x","sessionid","name","ioprocessors"].map(function(a){return b.x["_"+a]=b[a]}).concat(c.isIn.bind(c));return a.apply(c,d)}function deserializeSerializedConfiguration(a,b){return a.map(function(a){var c=b[a];if(!c)throw new Error("Error loading serialized configuration. Unable to locate state with id "+a);return c})}function deserializeHistory(a,b){var c={};return Object.keys(a).forEach(function(d){c[d]=a[d].map(function(a){var c=b[a];if(!c)throw new Error("Error loading serialized history. Unable to locate state with id "+a);return c})}),c}function BaseInterpreter(a,b){this._scriptingContext=b.interpreterScriptingContext||(b.InterpreterScriptingContext?new b.InterpreterScriptingContext(this):{});var c;c="function"==typeof a?initializeModelGeneratorFn(a,b,this):"string"==typeof a?JSON.parse(a):a,this._model=initializeModel(c),this.opts=b||{},this.opts.console=b.console||("undefined"==typeof console?{log:function(){}}:console),this.opts.Set=this.opts.Set||ArraySet,this.opts.priorityComparisonFn=this.opts.priorityComparisonFn||getTransitionWithHigherSourceChildPriority,this.opts.transitionSelector=this.opts.transitionSelector||scxmlPrefixTransitionSelector,this._scriptingContext.log=this._scriptingContext.log||this.opts.console.log,this._internalEventQueue=[],b.snapshot?(this._configuration=new this.opts.Set(deserializeSerializedConfiguration(b.snapshot[0],this._model.$idToStateMap)),this._historyValue=deserializeHistory(b.snapshot[1],this._model.$idToStateMap),this._isInFinalState=b.snapshot[2],this._model.$deserializeDatamodel(b.snapshot[3])):(this._configuration=new this.opts.Set,this._historyValue={},this._isInFinalState=!1),this._x={_sessionId:b.sessionId||null,_name:c.name||b.name||null,_ioprocessors:b.ioprocessors||null},this._listeners=[]}function Statechart(a,b){b=b||{},b.InterpreterScriptingContext=b.InterpreterScriptingContext||InterpreterScriptingContext,this._isStepping=!1,this._externalEventQueue=[],BaseInterpreter.call(this,a,b)}function beget(a){function b(){}return b.prototype=a,new b}function InterpreterScriptingContext(a){this._interpreter=a,this._timeoutMap={}}var STATE_TYPES={BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5};ArraySet.prototype={add:function(a){return this.contains(a)?void 0:this.o.push(a)},remove:function(a){var b=this.o.indexOf(a);return-1===b?!1:(this.o.splice(b,1),!0)},union:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.add(a)},this),this},difference:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.remove(a)},this),this},contains:function(a){return this.o.indexOf(a)>-1},iter:function(){return this.o},isEmpty:function(){return!this.o.length},equals:function(a){var b=a.iter(),c=this.o;return c.every(function(a){return b.indexOf(a)>-1})&&b.every(function(a){return c.indexOf(a)>-1})},toString:function(){return"Set("+this.o.toString()+")"}};var scxmlPrefixTransitionSelector=function(){function a(a){return new RegExp("^"+a.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")}function b(b){return d[b]?d[b]:d[b]=a(b)}function c(a,c){return c&&c.name&&(a.events.indexOf("*")>-1?!0:a.events.filter(function(a){return b(a).test(c.name)}).length)}var d={};return function(a,b,d){return a.transitions.filter(function(a){return!(a.events&&!c(a,b)||a.cond&&!d(a.cond))})}}(),query={getAncestors:function(a,b){var c;return c=a.ancestors.indexOf(b),c>-1?a.ancestors.slice(0,c):a.ancestors},getAncestorsOrSelf:function(a,b){return[a].concat(this.getAncestors(a,b))},getDescendantsOrSelf:function(a){return[a].concat(a.descendants)},isOrthogonalTo:function(a,b){return!this.isAncestrallyRelatedTo(a,b)&&this.getLCA(a,b).typeEnum===STATE_TYPES.PARALLEL},isAncestrallyRelatedTo:function(a,b){return this.getAncestorsOrSelf(b).indexOf(a)>-1||this.getAncestorsOrSelf(a).indexOf(b)>-1},getLCA:function(a,b){var c=this.getAncestors(a).filter(function(a){return a.descendants.indexOf(b)>-1},this);return c[0]}},printTrace=!1;return BaseInterpreter.prototype={start:function(){return printTrace&&this.opts.console.log("performing initial big step"),this._configuration.add(this._model.initialRef),this._performBigStep(),this.getConfiguration()},getConfiguration:function(){return this._configuration.iter().map(function(a){return a.id})},getFullConfiguration:function(){return this._configuration.iter().map(function(a){return[a].concat(query.getAncestors(a))},this).reduce(function(a,b){return a.concat(b)},[]).map(function(a){return a.id}).reduce(function(a,b){return a.indexOf(b)>-1?a:a.concat(b)},[])},isIn:function(a){return this.getFullConfiguration().indexOf(a)>-1},isFinal:function(a){return this._isInFinalState},_performBigStep:function(a){a&&this._internalEventQueue.push(a);for(var b=!0;b;){var c=this._internalEventQueue.shift()||null,d=this._performSmallStep(c);b=!d.isEmpty()}this._isInFinalState=this._configuration.iter().every(function(a){return a.typeEnum===STATE_TYPES.FINAL})},_performSmallStep:function(a){printTrace&&this.opts.console.log("selecting transitions with currentEvent: ",a);var b=this._selectTransitions(a);if(printTrace&&this.opts.console.log("selected transitions: ",b),!b.isEmpty()){printTrace&&this.opts.console.log("sorted transitions: ",b);

var c=new this.opts.Set(b.iter().filter(function(a){return a.targets})),d=this._getStatesExited(c),e=d[0],f=d[1],g=this._getStatesEntered(c),h=g[0],i=g[1];printTrace&&this.opts.console.log("basicStatesExited ",e),printTrace&&this.opts.console.log("basicStatesEntered ",h),printTrace&&this.opts.console.log("statesExited ",f),printTrace&&this.opts.console.log("statesEntered ",i);var j=new this.opts.Set;printTrace&&this.opts.console.log("executing state exit actions");var k=this._evaluateAction.bind(this,a);f.forEach(function(a){(printTrace||this.opts.logStatesEnteredAndExited)&&this.opts.console.log("exiting ",a.id),this._listeners.forEach(function(b){b.onExit&&b.onExit(a.id)}),void 0!==a.onExit&&a.onExit.forEach(k);var b;a.historyRef&&(b=a.historyRef.isDeep?function(b){return b.typeEnum===STATE_TYPES.BASIC&&a.descendants.indexOf(b)>-1}:function(b){return b.parent===a},this._historyValue[a.historyRef.id]=f.filter(b))},this);var l=b.iter().sort(function(a,b){return a.documentOrder-b.documentOrder});printTrace&&this.opts.console.log("executing transitition actions"),l.forEach(function(a){var b=a.targets&&a.targets.map(function(a){return a.id});this._listeners.forEach(function(c){c.onTransition&&c.onTransition(a.source.id,b)}),void 0!==a.onTransition&&a.onTransition.forEach(k)},this),printTrace&&this.opts.console.log("executing state enter actions"),i.forEach(function(a){(printTrace||this.opts.logStatesEnteredAndExited)&&this.opts.console.log("entering",a.id),this._listeners.forEach(function(b){b.onEntry&&b.onEntry(a.id)}),void 0!==a.onEntry&&a.onEntry.forEach(k)},this),printTrace&&this.opts.console.log("updating configuration "),printTrace&&this.opts.console.log("old configuration ",this._configuration),this._configuration.difference(e),this._configuration.union(h),printTrace&&this.opts.console.log("new configuration ",this._configuration),j.isEmpty()||(printTrace&&this.opts.console.log("adding triggered events to inner queue ",j),this._internalEventQueue.push(j))}return b},_evaluateAction:function(a,b){return b.call(this._scriptingContext,a)},_getStatesExited:function(a){var b=new this.opts.Set,c=new this.opts.Set;a.iter().forEach(function(a){var d=a.scope,e=d.descendants;this._configuration.iter().forEach(function(a){e.indexOf(a)>-1&&(c.add(a),b.add(a),query.getAncestors(a,d).forEach(function(a){b.add(a)}))},this)},this);var d=b.iter().sort(function(a,b){return b.depth-a.depth});return[c,d]},_getStatesEntered:function(a){var b={statesToEnter:new this.opts.Set,basicStatesToEnter:new this.opts.Set,statesProcessed:new this.opts.Set,statesToProcess:[]};a.iter().forEach(function(a){a.targets.forEach(function(c){this._addStateAndAncestors(c,a.scope,b)},this)},this);for(var c;c=b.statesToProcess.pop();)this._addStateAndDescendants(c,b);var d=b.statesToEnter.iter().sort(function(a,b){return a.depth-b.depth});return[b.basicStatesToEnter,d]},_addStateAndAncestors:function(a,b,c){this._addStateAndDescendants(a,c),query.getAncestors(a,b).forEach(function(a){a.typeEnum===STATE_TYPES.COMPOSITE?(c.statesToEnter.add(a),c.statesProcessed.add(a)):this._addStateAndDescendants(a,c)},this)},_addStateAndDescendants:function(a,b){b.statesProcessed.contains(a)||(a.typeEnum===STATE_TYPES.HISTORY?a.id in this._historyValue?this._historyValue[a.id].forEach(function(c){this._addStateAndAncestors(c,a.parent,b)},this):(b.statesToEnter.add(a),b.basicStatesToEnter.add(a)):(b.statesToEnter.add(a),a.typeEnum===STATE_TYPES.PARALLEL?b.statesToProcess.push.apply(b.statesToProcess,a.states.filter(function(a){return a.typeEnum!==STATE_TYPES.HISTORY})):a.typeEnum===STATE_TYPES.COMPOSITE?b.statesToProcess.push(a.initialRef):(a.typeEnum===STATE_TYPES.INITIAL||a.typeEnum===STATE_TYPES.BASIC||a.typeEnum===STATE_TYPES.FINAL)&&b.basicStatesToEnter.add(a)),b.statesProcessed.add(a))},_selectTransitions:function(a){if(this.opts.onlySelectFromBasicStates)var b=this._configuration.iter();else{var c=new this.opts.Set;this._configuration.iter().forEach(function(a){c.add(a),query.getAncestors(a).forEach(function(a){c.add(a)})},this),b=c.iter()}var d=a&&a.name&&a.name.search("."),e=d?scxmlPrefixTransitionSelector:this.opts.transitionSelector,f=new this.opts.Set,g=this._evaluateAction.bind(this,a);b.forEach(function(b){e(b,a,g).forEach(function(a){f.add(a)})});var h=this._selectPriorityEnabledTransitions(f);return printTrace&&this.opts.console.log("priorityEnabledTransitions",h),h},_selectPriorityEnabledTransitions:function(a){var b=new this.opts.Set,c=this._getInconsistentTransitions(a),d=c[0],e=c[1];for(b.union(d),printTrace&&this.opts.console.log("enabledTransitions",a),printTrace&&this.opts.console.log("consistentTransitions",d),printTrace&&this.opts.console.log("inconsistentTransitionsPairs",e),printTrace&&this.opts.console.log("priorityEnabledTransitions",b);!e.isEmpty();)a=new this.opts.Set(e.iter().map(function(a){return this.opts.priorityComparisonFn(a)},this)),c=this._getInconsistentTransitions(a),d=c[0],e=c[1],b.union(d),printTrace&&this.opts.console.log("enabledTransitions",a),printTrace&&this.opts.console.log("consistentTransitions",d),printTrace&&this.opts.console.log("inconsistentTransitionsPairs",e),printTrace&&this.opts.console.log("priorityEnabledTransitions",b);return b},_getInconsistentTransitions:function(a){var b=new this.opts.Set,c=new this.opts.Set,d=a.iter();printTrace&&this.opts.console.log("transitions",d);for(var e=0;e<d.length;e++)for(var f=e+1;f<d.length;f++){var g=d[e],h=d[f];this._conflicts(g,h)&&(b.add(g),b.add(h),c.add([g,h]))}var i=a.difference(b);return[i,c]},_conflicts:function(a,b){return!this._isArenaOrthogonal(a,b)},_isArenaOrthogonal:function(a,b){printTrace&&this.opts.console.log("transition scopes",a.scope,b.scope);var c=query.isOrthogonalTo(a.scope,b.scope);return printTrace&&this.opts.console.log("transition scopes are orthogonal?",c),c},registerListener:function(a){return this._listeners.push(a)},unregisterListener:function(a){return this._listeners.splice(this._listeners.indexOf(a),1)},getAllTransitionEvents:function(){function a(c){c.transitions&&c.transitions.forEach(function(a){b[a.event]=!0}),c.states&&c.states.forEach(a)}var b={};return a(this._model),Object.keys(b)},getSnapshot:function(){if(this._isStepping)throw new Error("getSnapshot cannot be called while interpreter is executing a big-step");return[this.getConfiguration(),this._serializeHistory(),this._isInFinalState,this._model.$serializeDatamodel()]},_serializeHistory:function(){var a={};return Object.keys(this._historyValue).forEach(function(b){a[b]=this._historyValue[b].map(function(a){return a.id})},this),a}},Statechart.prototype=beget(BaseInterpreter.prototype),Statechart.prototype.gen=function(a,b){var c;switch(typeof a){case"string":c={name:a,data:b};break;case"object":if("string"!=typeof a.name)throw new Error('Event object must have "name" property of type string.');c=a;break;default:throw new Error("First argument to gen must be a string or object.")}if(this._externalEventQueue.push(c),this._isStepping)return null;this._isStepping=!0;for(var d;d=this._externalEventQueue.shift();)this._performBigStep(d);return this._isStepping=!1,this.getConfiguration()},InterpreterScriptingContext.prototype={raise:function(a){this._interpreter._internalEventQueue.push(a)},send:function(a,b){if(void 0===b.delay)this.gen(a);else{if("undefined"==typeof setTimeout)throw new Error("Default implementation of Statechart.prototype.send will not work unless setTimeout is defined globally.");printTrace&&this._interpreter.opts.log("sending event",a.name,"with content",a.data,"after delay",b.delay);var c=setTimeout(this._interpreter.gen.bind(this._interpreter,a),b.delay||0);b.sendid&&(this._timeoutMap[b.sendid]=c)}},cancel:function(a){if("undefined"==typeof clearTimeout)throw new Error("Default implementation of Statechart.prototype.cancel will not work unless setTimeout is defined globally.");a in this._timeoutMap&&(printTrace&&this._interpreter.opts.log("cancelling ",a," with timeout id ",this._timeoutMap[a]),clearTimeout(this._timeoutMap[a]))}},{BaseInterpreter:BaseInterpreter,Statechart:Statechart,ArraySet:ArraySet,STATE_TYPES:STATE_TYPES,initializeModel:initializeModel,InterpreterScriptingContext:InterpreterScriptingContext}}),define("scalejs.functional/functional",[],function(){function a(){var a=Array.prototype.slice.call(arguments,0).reverse();return function(){var b=a.reduce(function(a,b){return[b.apply(void 0,a)]},Array.prototype.slice.call(arguments));return b[0]}}function b(){var a=Array.prototype.slice.call(arguments,0);return function(){var b=a.reduce(function(a,b){return[b.apply(void 0,a)]},Array.prototype.slice.call(arguments,0));return b[0]}}function c(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return b.apply(a,c.concat(Array.prototype.slice.call(arguments,0)))}}function d(a,b){return function(){return a.apply(void 0,Array.prototype.slice.call(arguments,0,b))}}function e(){var a=Array.prototype.slice.call(arguments,0),b=a.reduce(function(a,b,c){return b===g?a.concat([c]):a},[]);return 0===b.length?a[0].apply(void 0,a.slice(1)):function(){var c;for(c=0;c<Math.min(b.length,arguments.length);c+=1)a[b[c]]=arguments[c];return e.apply(void 0,a)}}var f,g={};return f=function(a,b){if(1===arguments.length)return f(a,a.length);var c=Array.prototype.slice.call(arguments,2);return c.length>=b?a.apply(this,c):function(){var d=c.concat(Array.prototype.slice.call(arguments,0));return d.unshift(a,b),f.apply(this,d)}},{_:g,compose:a,sequence:b,bind:c,aritize:d,curry:f,partial:e}}),define("scalejs.functional/builder",[],function(){function a(a){var b,c,d,e;return d=function(a){if(!a||"$"!==a.kind)return a;if("function"==typeof a.expr)return a.expr.call(this);if("string"==typeof a.expr)return this[a.expr];throw new Error("Parameter in $(...) must be either a function or a string referencing a binding.")},e=function(a,e,f){function g(a){return"$return"===a||"$RETURN"===a||"$yield"===a||"$YIELD"===a}if("function"!=typeof c[a]&&"$then"!==a&&"$else"!==a)throw new Error("This control construct may only be used if the computation expression builder defines a `"+a+"` method.");var h,i=d(e);if(f.length>0&&"function"!=typeof c.combine)throw new Error("This control construct may only be used if the computation expression builder defines a `combine` method.");if(g(a)){if(0===f.length)return c[a](i);if("function"!=typeof c.delay)throw new Error("This control construct may only be used if the computation expression builder defines a `delay` method.");return c.combine(c[a](i),c.delay(function(){return b(f)}))}if("$for"===a)return c.combine(c.$for(e.items,function(a){var c=Array.prototype.slice.call(e.cexpr);return this[e.name]=a,b(c)}),b(f));if("$while"===a){if("function"!=typeof c.delay)throw new Error("This control construct may only be used if the computation expression builder defines a `delay` method.");return i=c.$while(e.condition.bind(this),c.delay(function(){var a=Array.prototype.slice.call(e.cexpr);return b(a)})),f.length>0?c.combine(i,b(f)):i}return"$then"===a||"$else"===a?(h=Array.prototype.slice.call(e.cexpr),c.combine(b(h),f)):c.combine(c[a](i),b(f))},a.missing||(a.missing=function(a){if(a.kind)throw new Error('Unknown operation "'+a.kind+'". Either define `missing` method on the builder or fix the spelling of the operation.');throw new Error("Expression "+JSON.stringify(a)+" cannot be processed. Either define `missing` method on the builder or convert expression to a function.")}),b=function(a){var f;if(a=Array.prototype.slice.call(a),0===a.length){if(c.zero)return c.zero();throw new Error("Computation expression builder must define `zero` method.")}if(f=a.shift(),"let"===f.kind)return this[f.name]=d(f.expr),b.call(this,a);if("do"===f.kind)return f.expr.call(this),b.call(this,a);if("letBind"===f.kind)return c.bind(f.expr.bind(this),function(c){return this[f.name]=c,b.call(this,a)}.bind(this));if("doBind"===f.kind||"$"===f.kind){if(a.length>0)return c.bind(f.expr.bind(this),function(){return b.call(this,a)}.bind(this));if("function"!=typeof c.$return)throw new Error("This control construct may only be used if the computation expression builder defines a `$return` method.");return c.bind(f.expr.bind(this),function(a){return c.$return(a)})}return"$return"===f.kind||"$RETURN"===f.kind||"$yield"===f.kind||"$YIELD"===f.kind?e(f.kind,f.expr,a):"$for"===f.kind||"$while"===f.kind?e(f.kind,f,a):"$if"===f.kind?f.condition.call(this)?e("$then",f.thenExpr,a):f.elseExpr?e("$else",f.elseExpr,a):e(b([]),a):"function"==typeof f&&c.call?(c.call(this),b.call(this,a)):"function"==typeof f?(f.call(this),b.call(this,a)):e("missing",f,a)},function(){function d(){var a={mixins:Array.prototype.slice.call(arguments,0)},b=f.bind(a);return b.mixin=function(){return Array.prototype.push.apply(a.mixins,arguments),b},b}var e=Array.prototype.slice.call(arguments),f=function(){var d,f,g,h=Array.prototype.slice.call(arguments,0);return c={},Object.keys(a).forEach(function(b){c[b]=a[b]}),this.mixins&&this.mixins.forEach(function(a){a.beforeBuild&&a.beforeBuild(h)}),g=function(){return b.call(this,h)},c.run||c.delay?(c.delay&&(f=g,g=function(){return c.delay(f)}),d=g(),c.run&&(d=c.run.apply(c,[d].concat(e)))):d=g(),this.mixins&&this.mixins.forEach(function(a){a.afterBuild&&(d=a.afterBuild(d))}),d};return f.mixin=d,f}}return a.$let=function(a,b){return{kind:"let",name:a,expr:b}},a.$LET=function(a,b){return{kind:"letBind",name:a,expr:b}},a.$do=function(a){return{kind:"do",expr:a}},a.$DO=function(a){return{kind:"doBind",expr:a}},a.$return=function(a){return{kind:"$return",expr:a}},a.$RETURN=function(a){return{kind:"$RETURN",expr:a}},a.$yield=function(a){return{kind:"$yield",expr:a}},a.$YIELD=function(a){return{kind:"$YIELD",expr:a}},a.$for=function(a,b){var c=Array.prototype.slice.call(arguments,2);return{kind:"$for",name:a,items:b,cexpr:c}},a.$while=function(a){if(arguments.length<2)throw new Error('Incomplete `while`. Expected "$while(<condition>, <expr>)".');var b=Array.prototype.slice.call(arguments,1);return{kind:"$while",condition:a,cexpr:b}},a.$if=function(a,b,c){if(arguments.length<2)throw new Error('Incomplete conditional. Expected "$if(<expr>, $then(expr))" or "$if(<expr>, $then(<expr>), $else(<expr>)"');if("function"!=typeof a)throw new Error("First argument must be a function that defines the condition of $if.");if("$then"!==b.kind)throw new Error('Unexpected "'+b.kind+'" in the place of "$then"');if(c&&"$else"!==c.kind)throw new Error('Unexpected "'+c.kind+'" in the place of "$else"');return{kind:"$if",condition:a,thenExpr:b,elseExpr:c}},a.$then=function(){var a=Array.prototype.slice.call(arguments,0);if(0===a.length)throw new Error("$then should contain at least one expression.");return{kind:"$then",cexpr:a}},a.$else=function(){var a=Array.prototype.slice.call(arguments,0);if(0===a.length)throw new Error("$else should contain at least one expression.");return{kind:"$else",cexpr:a}},a.$=function(a){return{kind:"$",expr:a}},a}),define("scalejs.functional/continuationBuilder",["./builder"],function(a){var b,c;return b=a({bind:function(a,b){return function(c,d){a(function(a){var e=b(a);return e(c,d)},d)}},$return:function(a){return function(b){b&&("function"==typeof a&&(a=a()),b(a))}},delay:function(a){return a},run:function(a){return function(b,c){var d=a.call(this);d.call(this,b,c)}}}),c=b().mixin({beforeBuild:function(b){b.forEach(function(c,d){"function"==typeof c&&(b[d]=a.$DO(c))})}})}),define("scalejs.functional",["scalejs!core","./scalejs.functional/functional","./scalejs.functional/builder","./scalejs.functional/continuationBuilder"],function(a,b,c,d){var e=a.object.merge;a.registerExtension({functional:e(b,{builder:c,builders:{continuation:d}})})}),function(a,b){var c={Identity:function(a){return a},True:function(){return!0},Blank:function(){}},d={Boolean:typeof!0,Number:"number",String:"string",Object:typeof{},Undefined:typeof b,Function:"function"},e={"":c.Identity},f={createLambda:function(a){if(null==a)return c.Identity;if(typeof a===d.String){var b=e[a];if(null!=b)return b;if(-1===a.indexOf("=>")){for(var f,g=new RegExp("[$]+","g"),h=0;null!=(f=g.exec(a));){var i=f[0].length;i>h&&(h=i)}for(var j=[],k=1;h>=k;k++){for(var l="",m=0;k>m;m++)l+="$";j.push(l)}var n=Array.prototype.join.call(j,",");return b=new Function(n,"return "+a),e[a]=b,b}var o=a.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/);return b=new Function(o[1],"return "+o[2]),e[a]=b,b}return a},isIEnumerable:function(a){if(typeof Enumerator!==d.Undefined)try{return new Enumerator(a),!0}catch(b){}return!1},defineProperty:null!=Object.defineProperties?function(a,b,c){Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!0,value:c})}:function(a,b,c){a[b]=c},compare:function(a,b){return a===b?0:a>b?1:-1},dispose:function(a){null!=a&&a.dispose()}},g={Before:0,Running:1,After:2},h=function(a,b,c){var d=new i,e=g.Before;this.current=d.current,this.moveNext=function(){try{switch(e){case g.Before:e=g.Running,a();case g.Running:return b.apply(d)?!0:(this.dispose(),!1);case g.After:return!1}}catch(c){throw this.dispose(),c}},this.dispose=function(){if(e==g.Running)try{c()}finally{e=g.After}}},i=function(){var a=null;this.current=function(){return a},this.yieldReturn=function(b){return a=b,!0},this.yieldBreak=function(){return!1}},j=function(a){this.getEnumerator=a};j.Utils={},j.Utils.createLambda=function(a){return f.createLambda(a)},j.Utils.createEnumerable=function(a){return new j(a)},j.Utils.createEnumerator=function(a,b,c){return new h(a,b,c)},j.Utils.extendTo=function(a){var b,c=a.prototype;a===Array?(b=n.prototype,f.defineProperty(c,"getSource",function(){return this})):(b=j.prototype,f.defineProperty(c,"getEnumerator",function(){return j.from(this).getEnumerator()}));for(var d in b){var e=b[d];c[d]!=e&&(null==c[d]||(d+="ByLinq",c[d]!=e))&&e instanceof Function&&f.defineProperty(c,d,e)}},j.choice=function(){var a=arguments;return new j(function(){return new h(function(){a=a[0]instanceof Array?a[0]:null!=a[0].getEnumerator?a[0].toArray():a},function(){return this.yieldReturn(a[Math.floor(Math.random()*a.length)])},c.Blank)})},j.cycle=function(){var a=arguments;return new j(function(){var b=0;return new h(function(){a=a[0]instanceof Array?a[0]:null!=a[0].getEnumerator?a[0].toArray():a},function(){return b>=a.length&&(b=0),this.yieldReturn(a[b++])},c.Blank)})},j.empty=function(){return new j(function(){return new h(c.Blank,function(){return!1},c.Blank)})},j.from=function(a){if(null==a)return j.empty();if(a instanceof j)return a;if(typeof a==d.Number||typeof a==d.Boolean)return j.repeat(a,1);if(typeof a==d.String)return new j(function(){var b=0;return new h(c.Blank,function(){return b<a.length?this.yieldReturn(a.charAt(b++)):!1},c.Blank)});if(typeof a!=d.Function){if(typeof a.length==d.Number)return new n(a);if(!(a instanceof Object)&&f.isIEnumerable(a))return new j(function(){var b,d=!0;return new h(function(){b=new Enumerator(a)},function(){return d?d=!1:b.moveNext(),b.atEnd()?!1:this.yieldReturn(b.item())},c.Blank)});if(typeof Windows===d.Object&&typeof a.first===d.Function)return new j(function(){var b,d=!0;return new h(function(){b=a.first()},function(){return d?d=!1:b.moveNext(),b.hasCurrent?this.yieldReturn(b.current):this.yieldBreak()},c.Blank)})}return new j(function(){var b=[],d=0;return new h(function(){for(var c in a){var d=a[c];d instanceof Function||!Object.prototype.hasOwnProperty.call(a,c)||b.push({key:c,value:d})}},function(){return d<b.length?this.yieldReturn(b[d++]):!1},c.Blank)})},j.make=function(a){return j.repeat(a,1)},j.matches=function(a,b,d){return null==d&&(d=""),b instanceof RegExp&&(d+=b.ignoreCase?"i":"",d+=b.multiline?"m":"",b=b.source),-1===d.indexOf("g")&&(d+="g"),new j(function(){var e;return new h(function(){e=new RegExp(b,d)},function(){var b=e.exec(a);return b?this.yieldReturn(b):!1},c.Blank)})},j.range=function(a,b,d){return null==d&&(d=1),new j(function(){var e,f=0;return new h(function(){e=a-d},function(){return f++<b?this.yieldReturn(e+=d):this.yieldBreak()},c.Blank)})},j.rangeDown=function(a,b,d){return null==d&&(d=1),new j(function(){var e,f=0;return new h(function(){e=a+d},function(){return f++<b?this.yieldReturn(e-=d):this.yieldBreak()},c.Blank)})},j.rangeTo=function(a,b,d){return null==d&&(d=1),new j(b>a?function(){var e;return new h(function(){e=a-d},function(){var a=e+=d;return b>=a?this.yieldReturn(a):this.yieldBreak()},c.Blank)}:function(){var e;return new h(function(){e=a+d},function(){var a=e-=d;return a>=b?this.yieldReturn(a):this.yieldBreak()},c.Blank)})},j.repeat=function(a,b){return null!=b?j.repeat(a).take(b):new j(function(){return new h(c.Blank,function(){return this.yieldReturn(a)},c.Blank)})},j.repeatWithFinalize=function(a,b){return a=f.createLambda(a),b=f.createLambda(b),new j(function(){var c;return new h(function(){c=a()},function(){return this.yieldReturn(c)},function(){null!=c&&(b(c),c=null)})})},j.generate=function(a,b){return null!=b?j.generate(a).take(b):(a=f.createLambda(a),new j(function(){return new h(c.Blank,function(){return this.yieldReturn(a())},c.Blank)}))},j.toInfinity=function(a,b){return null==a&&(a=0),null==b&&(b=1),new j(function(){var d;return new h(function(){d=a-b},function(){return this.yieldReturn(d+=b)},c.Blank)})},j.toNegativeInfinity=function(a,b){return null==a&&(a=0),null==b&&(b=1),new j(function(){var d;return new h(function(){d=a+b},function(){return this.yieldReturn(d-=b)},c.Blank)})},j.unfold=function(a,b){return b=f.createLambda(b),new j(function(){var d,e=!0;return new h(c.Blank,function(){return e?(e=!1,d=a,this.yieldReturn(d)):(d=b(d),this.yieldReturn(d))},c.Blank)})},j.defer=function(a){return new j(function(){var b;return new h(function(){b=j.from(a()).getEnumerator()},function(){return b.moveNext()?this.yieldReturn(b.current()):this.yieldBreak()},function(){f.dispose(b)})})},j.prototype.traverseBreadthFirst=function(a,b){var c=this;return a=f.createLambda(a),b=f.createLambda(b),new j(function(){var d,e=0,g=[];return new h(function(){d=c.getEnumerator()},function(){for(;;){if(d.moveNext())return g.push(d.current()),this.yieldReturn(b(d.current(),e));var c=j.from(g).selectMany(function(b){return a(b)});if(!c.any())return!1;e++,g=[],f.dispose(d),d=c.getEnumerator()}},function(){f.dispose(d)})})},j.prototype.traverseDepthFirst=function(a,b){var c=this;return a=f.createLambda(a),b=f.createLambda(b),new j(function(){var d,e=[];return new h(function(){d=c.getEnumerator()},function(){for(;;){if(d.moveNext()){var c=b(d.current(),e.length);return e.push(d),d=j.from(a(d.current())).getEnumerator(),this.yieldReturn(c)}if(e.length<=0)return!1;f.dispose(d),d=e.pop()}},function(){try{f.dispose(d)}finally{j.from(e).forEach(function(a){a.dispose()})}})})},j.prototype.flatten=function(){var a=this;return new j(function(){var b,d=null;return new h(function(){b=a.getEnumerator()},function(){for(;;){if(null!=d){if(d.moveNext())return this.yieldReturn(d.current());d=null}if(b.moveNext()){if(b.current()instanceof Array){f.dispose(d),d=j.from(b.current()).selectMany(c.Identity).flatten().getEnumerator();continue}return this.yieldReturn(b.current())}return!1}},function(){try{f.dispose(b)}finally{f.dispose(d)}})})},j.prototype.pairwise=function(a){var b=this;return a=f.createLambda(a),new j(function(){var c;return new h(function(){c=b.getEnumerator(),c.moveNext()},function(){var b=c.current();return c.moveNext()?this.yieldReturn(a(b,c.current())):!1},function(){f.dispose(c)})})},j.prototype.scan=function(a,b){var c;null==b?(b=f.createLambda(a),c=!1):(b=f.createLambda(b),c=!0);var d=this;return new j(function(){var e,g,i=!0;return new h(function(){e=d.getEnumerator()},function(){if(i){if(i=!1,c)return this.yieldReturn(g=a);if(e.moveNext())return this.yieldReturn(g=e.current())}return e.moveNext()?this.yieldReturn(g=b(g,e.current())):!1},function(){f.dispose(e)})})},j.prototype.select=function(a){if(a=f.createLambda(a),a.length<=1)return new p(this,null,a);var b=this;return new j(function(){var c,d=0;return new h(function(){c=b.getEnumerator()},function(){return c.moveNext()?this.yieldReturn(a(c.current(),d++)):!1},function(){f.dispose(c)})})},j.prototype.selectMany=function(a,c){var d=this;return a=f.createLambda(a),null==c&&(c=function(a,b){return b}),c=f.createLambda(c),new j(function(){var e,g=b,i=0;return new h(function(){e=d.getEnumerator()},function(){if(g===b&&!e.moveNext())return!1;do{if(null==g){var d=a(e.current(),i++);g=j.from(d).getEnumerator()}if(g.moveNext())return this.yieldReturn(c(e.current(),g.current()));f.dispose(g),g=null}while(e.moveNext());return!1},function(){try{f.dispose(e)}finally{f.dispose(g)}})})},j.prototype.where=function(a){if(a=f.createLambda(a),a.length<=1)return new o(this,a);var b=this;return new j(function(){var c,d=0;return new h(function(){c=b.getEnumerator()},function(){for(;c.moveNext();)if(a(c.current(),d++))return this.yieldReturn(c.current());return!1},function(){f.dispose(c)})})},j.prototype.choose=function(a){a=f.createLambda(a);var b=this;return new j(function(){var c,d=0;return new h(function(){c=b.getEnumerator()},function(){for(;c.moveNext();){var b=a(c.current(),d++);if(null!=b)return this.yieldReturn(b)}return this.yieldBreak()},function(){f.dispose(c)})})},j.prototype.ofType=function(a){var b;switch(a){case Number:b=d.Number;break;case String:b=d.String;break;case Boolean:b=d.Boolean;break;case Function:b=d.Function;break;default:b=null}return this.where(null===b?function(b){return b instanceof a}:function(a){return typeof a===b})},j.prototype.zip=function(){var a=arguments,b=f.createLambda(arguments[arguments.length-1]),c=this;if(2==arguments.length){var d=arguments[0];return new j(function(){var a,e,g=0;return new h(function(){a=c.getEnumerator(),e=j.from(d).getEnumerator()},function(){return a.moveNext()&&e.moveNext()?this.yieldReturn(b(a.current(),e.current(),g++)):!1},function(){try{f.dispose(a)}finally{f.dispose(e)}})})}return new j(function(){var d,e=0;return new h(function(){var b=j.make(c).concat(j.from(a).takeExceptLast().select(j.from)).select(function(a){return a.getEnumerator()}).toArray();d=j.from(b)},function(){if(d.all(function(a){return a.moveNext()})){var a=d.select(function(a){return a.current()}).toArray();return a.push(e++),this.yieldReturn(b.apply(null,a))}return this.yieldBreak()},function(){j.from(d).forEach(f.dispose)})})},j.prototype.merge=function(){var a=arguments,b=this;return new j(function(){var c,d=-1;return new h(function(){c=j.make(b).concat(j.from(a).select(j.from)).select(function(a){return a.getEnumerator()}).toArray()},function(){for(;c.length>0;){d=d>=c.length-1?0:d+1;var a=c[d];if(a.moveNext())return this.yieldReturn(a.current());a.dispose(),c.splice(d--,1)}return this.yieldBreak()},function(){j.from(c).forEach(f.dispose)})})},j.prototype.join=function(a,d,e,g,i){d=f.createLambda(d),e=f.createLambda(e),g=f.createLambda(g),i=f.createLambda(i);var k=this;return new j(function(){var l,m,n=null,o=0;return new h(function(){l=k.getEnumerator(),m=j.from(a).toLookup(e,c.Identity,i)},function(){for(;;){if(null!=n){var a=n[o++];if(a!==b)return this.yieldReturn(g(l.current(),a));a=null,o=0}if(!l.moveNext())return!1;var c=d(l.current());n=m.get(c).toArray()}},function(){f.dispose(l)})})},j.prototype.groupJoin=function(a,b,d,e,g){b=f.createLambda(b),d=f.createLambda(d),e=f.createLambda(e),g=f.createLambda(g);var i=this;return new j(function(){var k=i.getEnumerator(),l=null;return new h(function(){k=i.getEnumerator(),l=j.from(a).toLookup(d,c.Identity,g)},function(){if(k.moveNext()){var a=l.get(b(k.current()));return this.yieldReturn(e(k.current(),a))}return!1},function(){f.dispose(k)})})},j.prototype.all=function(a){a=f.createLambda(a);var b=!0;return this.forEach(function(c){return a(c)?void 0:(b=!1,!1)}),b},j.prototype.any=function(a){a=f.createLambda(a);var b=this.getEnumerator();try{if(0==arguments.length)return b.moveNext();for(;b.moveNext();)if(a(b.current()))return!0;return!1}finally{f.dispose(b)}},j.prototype.isEmpty=function(){return!this.any()},j.prototype.concat=function(){var a=this;if(1==arguments.length){var b=arguments[0];return new j(function(){var c,d;return new h(function(){c=a.getEnumerator()},function(){if(null==d){if(c.moveNext())return this.yieldReturn(c.current());d=j.from(b).getEnumerator()}return d.moveNext()?this.yieldReturn(d.current()):!1},function(){try{f.dispose(c)}finally{f.dispose(d)}})})}var c=arguments;return new j(function(){var b;return new h(function(){b=j.make(a).concat(j.from(c).select(j.from)).select(function(a){return a.getEnumerator()}).toArray()},function(){for(;b.length>0;){var a=b[0];if(a.moveNext())return this.yieldReturn(a.current());a.dispose(),b.splice(0,1)}return this.yieldBreak()},function(){j.from(b).forEach(f.dispose)})})},j.prototype.insert=function(a,b){var c=this;return new j(function(){var d,e,g=0,i=!1;return new h(function(){d=c.getEnumerator(),e=j.from(b).getEnumerator()},function(){return g==a&&e.moveNext()?(i=!0,this.yieldReturn(e.current())):d.moveNext()?(g++,this.yieldReturn(d.current())):!i&&e.moveNext()?this.yieldReturn(e.current()):!1},function(){try{f.dispose(d)}finally{f.dispose(e)}})})},j.prototype.alternate=function(a){var b=this;return new j(function(){var c,d,e,g;return new h(function(){e=a instanceof Array||null!=a.getEnumerator?j.from(j.from(a).toArray()):j.make(a),d=b.getEnumerator(),d.moveNext()&&(c=d.current())},function(){for(;;){if(null!=g){if(g.moveNext())return this.yieldReturn(g.current());g=null}{if(null!=c||!d.moveNext()){if(null!=c){var a=c;return c=null,this.yieldReturn(a)}return this.yieldBreak()}c=d.current(),g=e.getEnumerator()}}},function(){try{f.dispose(d)}finally{f.dispose(g)}})})},j.prototype.contains=function(a,b){b=f.createLambda(b);var c=this.getEnumerator();try{for(;c.moveNext();)if(b(c.current())===a)return!0;return!1}finally{f.dispose(c)}},j.prototype.defaultIfEmpty=function(a){var c=this;return a===b&&(a=null),new j(function(){var b,d=!0;return new h(function(){b=c.getEnumerator()},function(){return b.moveNext()?(d=!1,this.yieldReturn(b.current())):d?(d=!1,this.yieldReturn(a)):!1},function(){f.dispose(b)})})},j.prototype.distinct=function(a){return this.except(j.empty(),a)},j.prototype.distinctUntilChanged=function(a){a=f.createLambda(a);var b=this;return new j(function(){var c,d,e;return new h(function(){c=b.getEnumerator()},function(){for(;c.moveNext();){var b=a(c.current());if(e)return e=!1,d=b,this.yieldReturn(c.current());if(d!==b)return d=b,this.yieldReturn(c.current())}return this.yieldBreak()},function(){f.dispose(c)})})},j.prototype.except=function(a,b){b=f.createLambda(b);var c=this;return new j(function(){var d,e;return new h(function(){d=c.getEnumerator(),e=new q(b),j.from(a).forEach(function(a){e.add(a)})},function(){for(;d.moveNext();){var a=d.current();if(!e.contains(a))return e.add(a),this.yieldReturn(a)}return!1},function(){f.dispose(d)})})},j.prototype.intersect=function(a,b){b=f.createLambda(b);var c=this;return new j(function(){var d,e,g;return new h(function(){d=c.getEnumerator(),e=new q(b),j.from(a).forEach(function(a){e.add(a)}),g=new q(b)},function(){for(;d.moveNext();){var a=d.current();if(!g.contains(a)&&e.contains(a))return g.add(a),this.yieldReturn(a)}return!1},function(){f.dispose(d)})})},j.prototype.sequenceEqual=function(a,b){b=f.createLambda(b);var c=this.getEnumerator();try{var d=j.from(a).getEnumerator();try{for(;c.moveNext();)if(!d.moveNext()||b(c.current())!==b(d.current()))return!1;return d.moveNext()?!1:!0}finally{f.dispose(d)}}finally{f.dispose(c)}},j.prototype.union=function(a,c){c=f.createLambda(c);var d=this;return new j(function(){var e,g,i;return new h(function(){e=d.getEnumerator(),i=new q(c)},function(){var c;if(g===b){for(;e.moveNext();)if(c=e.current(),!i.contains(c))return i.add(c),this.yieldReturn(c);g=j.from(a).getEnumerator()}for(;g.moveNext();)if(c=g.current(),!i.contains(c))return i.add(c),this.yieldReturn(c);return!1},function(){try{f.dispose(e)}finally{f.dispose(g)}})})},j.prototype.orderBy=function(a){return new k(this,a,!1)},j.prototype.orderByDescending=function(a){return new k(this,a,!0);

},j.prototype.reverse=function(){var a=this;return new j(function(){var b,d;return new h(function(){b=a.toArray(),d=b.length},function(){return d>0?this.yieldReturn(b[--d]):!1},c.Blank)})},j.prototype.shuffle=function(){var a=this;return new j(function(){var b;return new h(function(){b=a.toArray()},function(){if(b.length>0){var a=Math.floor(Math.random()*b.length);return this.yieldReturn(b.splice(a,1)[0])}return!1},c.Blank)})},j.prototype.weightedSample=function(a){a=f.createLambda(a);var b=this;return new j(function(){var d,e=0;return new h(function(){d=b.choose(function(b){var c=a(b);return 0>=c?null:(e+=c,{value:b,bound:e})}).toArray()},function(){if(d.length>0){for(var a=Math.floor(Math.random()*e)+1,b=-1,c=d.length;c-b>1;){var f=Math.floor((b+c)/2);d[f].bound>=a?c=f:b=f}return this.yieldReturn(d[c].value)}return this.yieldBreak()},c.Blank)})},j.prototype.groupBy=function(a,b,c,d){var e=this;return a=f.createLambda(a),b=f.createLambda(b),null!=c&&(c=f.createLambda(c)),d=f.createLambda(d),new j(function(){var g;return new h(function(){g=e.toLookup(a,b,d).toEnumerable().getEnumerator()},function(){for(;g.moveNext();)return this.yieldReturn(null==c?g.current():c(g.current().key(),g.current()));return!1},function(){f.dispose(g)})})},j.prototype.partitionBy=function(a,b,c,d){var e=this;a=f.createLambda(a),b=f.createLambda(b),d=f.createLambda(d);var g;return null==c?(g=!1,c=function(a,b){return new s(a,b)}):(g=!0,c=f.createLambda(c)),new j(function(){var i,k,l,m=[];return new h(function(){i=e.getEnumerator(),i.moveNext()&&(k=a(i.current()),l=d(k),m.push(b(i.current())))},function(){for(var e;1==(e=i.moveNext())&&l===d(a(i.current()));)m.push(b(i.current()));if(m.length>0){var f=g?c(k,j.from(m)):c(k,m);return e?(k=a(i.current()),l=d(k),m=[b(i.current())]):m=[],this.yieldReturn(f)}return!1},function(){f.dispose(i)})})},j.prototype.buffer=function(a){var b=this;return new j(function(){var c;return new h(function(){c=b.getEnumerator()},function(){for(var b=[],d=0;c.moveNext();)if(b.push(c.current()),++d>=a)return this.yieldReturn(b);return b.length>0?this.yieldReturn(b):!1},function(){f.dispose(c)})})},j.prototype.aggregate=function(a,b,c){return(c=f.createLambda(c))(this.scan(a,b,c).last())},j.prototype.average=function(a){a=f.createLambda(a);var b=0,c=0;return this.forEach(function(d){b+=a(d),++c}),b/c},j.prototype.count=function(a){a=null==a?c.True:f.createLambda(a);var b=0;return this.forEach(function(c,d){a(c,d)&&++b}),b},j.prototype.max=function(a){return null==a&&(a=c.Identity),this.select(a).aggregate(function(a,b){return a>b?a:b})},j.prototype.min=function(a){return null==a&&(a=c.Identity),this.select(a).aggregate(function(a,b){return b>a?a:b})},j.prototype.maxBy=function(a){return a=f.createLambda(a),this.aggregate(function(b,c){return a(b)>a(c)?b:c})},j.prototype.minBy=function(a){return a=f.createLambda(a),this.aggregate(function(b,c){return a(b)<a(c)?b:c})},j.prototype.sum=function(a){return null==a&&(a=c.Identity),this.select(a).aggregate(0,function(a,b){return a+b})},j.prototype.elementAt=function(a){var b,c=!1;if(this.forEach(function(d,e){return e==a?(b=d,c=!0,!1):void 0}),!c)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return b},j.prototype.elementAtOrDefault=function(a,c){c===b&&(c=null);var d,e=!1;return this.forEach(function(b,c){return c==a?(d=b,e=!0,!1):void 0}),e?d:c},j.prototype.first=function(a){if(null!=a)return this.where(a).first();var b,c=!1;if(this.forEach(function(a){return b=a,c=!0,!1}),!c)throw new Error("first:No element satisfies the condition.");return b},j.prototype.firstOrDefault=function(a,c){if(c===b&&(c=null),null!=a)return this.where(a).firstOrDefault(null,c);var d,e=!1;return this.forEach(function(a){return d=a,e=!0,!1}),e?d:c},j.prototype.last=function(a){if(null!=a)return this.where(a).last();var b,c=!1;if(this.forEach(function(a){c=!0,b=a}),!c)throw new Error("last:No element satisfies the condition.");return b},j.prototype.lastOrDefault=function(a,c){if(c===b&&(c=null),null!=a)return this.where(a).lastOrDefault(null,c);var d,e=!1;return this.forEach(function(a){e=!0,d=a}),e?d:c},j.prototype.single=function(a){if(null!=a)return this.where(a).single();var b,c=!1;if(this.forEach(function(a){if(c)throw new Error("single:sequence contains more than one element.");c=!0,b=a}),!c)throw new Error("single:No element satisfies the condition.");return b},j.prototype.singleOrDefault=function(a,c){if(c===b&&(c=null),null!=a)return this.where(a).singleOrDefault(null,c);var d,e=!1;return this.forEach(function(a){if(e)throw new Error("single:sequence contains more than one element.");e=!0,d=a}),e?d:c},j.prototype.skip=function(a){var b=this;return new j(function(){var c,d=0;return new h(function(){for(c=b.getEnumerator();d++<a&&c.moveNext(););},function(){return c.moveNext()?this.yieldReturn(c.current()):!1},function(){f.dispose(c)})})},j.prototype.skipWhile=function(a){a=f.createLambda(a);var b=this;return new j(function(){var c,d=0,e=!1;return new h(function(){c=b.getEnumerator()},function(){for(;!e;){if(!c.moveNext())return!1;if(!a(c.current(),d++))return e=!0,this.yieldReturn(c.current())}return c.moveNext()?this.yieldReturn(c.current()):!1},function(){f.dispose(c)})})},j.prototype.take=function(a){var b=this;return new j(function(){var c,d=0;return new h(function(){c=b.getEnumerator()},function(){return d++<a&&c.moveNext()?this.yieldReturn(c.current()):!1},function(){f.dispose(c)})})},j.prototype.takeWhile=function(a){a=f.createLambda(a);var b=this;return new j(function(){var c,d=0;return new h(function(){c=b.getEnumerator()},function(){return c.moveNext()&&a(c.current(),d++)?this.yieldReturn(c.current()):!1},function(){f.dispose(c)})})},j.prototype.takeExceptLast=function(a){null==a&&(a=1);var b=this;return new j(function(){if(0>=a)return b.getEnumerator();var c,d=[];return new h(function(){c=b.getEnumerator()},function(){for(;c.moveNext();){if(d.length==a)return d.push(c.current()),this.yieldReturn(d.shift());d.push(c.current())}return!1},function(){f.dispose(c)})})},j.prototype.takeFromLast=function(a){if(0>=a||null==a)return j.empty();var b=this;return new j(function(){var c,d,e=[];return new h(function(){c=b.getEnumerator()},function(){for(;c.moveNext();)e.length==a&&e.shift(),e.push(c.current());return null==d&&(d=j.from(e).getEnumerator()),d.moveNext()?this.yieldReturn(d.current()):!1},function(){f.dispose(d)})})},j.prototype.indexOf=function(a){var b=null;return this.forEach(typeof a===d.Function?function(c,d){return a(c,d)?(b=d,!1):void 0}:function(c,d){return c===a?(b=d,!1):void 0}),null!==b?b:-1},j.prototype.lastIndexOf=function(a){var b=-1;return this.forEach(typeof a===d.Function?function(c,d){a(c,d)&&(b=d)}:function(c,d){c===a&&(b=d)}),b},j.prototype.cast=function(){return this},j.prototype.asEnumerable=function(){return j.from(this)},j.prototype.toArray=function(){var a=[];return this.forEach(function(b){a.push(b)}),a},j.prototype.toLookup=function(a,c,d){a=f.createLambda(a),c=f.createLambda(c),d=f.createLambda(d);var e=new q(d);return this.forEach(function(d){var f=a(d),g=c(d),h=e.get(f);h!==b?h.push(g):e.add(f,[g])}),new r(e)},j.prototype.toObject=function(a,b){a=f.createLambda(a),b=f.createLambda(b);var c={};return this.forEach(function(d){c[a(d)]=b(d)}),c},j.prototype.toDictionary=function(a,b,c){a=f.createLambda(a),b=f.createLambda(b),c=f.createLambda(c);var d=new q(c);return this.forEach(function(c){d.add(a(c),b(c))}),d},j.prototype.toJSONString=function(a,b){if(typeof JSON===d.Undefined||null==JSON.stringify)throw new Error("toJSONString can't find JSON.stringify. This works native JSON support Browser or include json2.js");return JSON.stringify(this.toArray(),a,b)},j.prototype.toJoinedString=function(a,b){return null==a&&(a=""),null==b&&(b=c.Identity),this.select(b).toArray().join(a)},j.prototype.doAction=function(a){var b=this;return a=f.createLambda(a),new j(function(){var c,d=0;return new h(function(){c=b.getEnumerator()},function(){return c.moveNext()?(a(c.current(),d++),this.yieldReturn(c.current())):!1},function(){f.dispose(c)})})},j.prototype.forEach=function(a){a=f.createLambda(a);var b=0,c=this.getEnumerator();try{for(;c.moveNext()&&a(c.current(),b++)!==!1;);}finally{f.dispose(c)}},j.prototype.write=function(a,b){null==a&&(a=""),b=f.createLambda(b);var c=!0;this.forEach(function(d){c?c=!1:document.write(a),document.write(b(d))})},j.prototype.writeLine=function(a){a=f.createLambda(a),this.forEach(function(b){document.writeln(a(b)+"<br />")})},j.prototype.force=function(){var a=this.getEnumerator();try{for(;a.moveNext(););}finally{f.dispose(a)}},j.prototype.letBind=function(a){a=f.createLambda(a);var b=this;return new j(function(){var c;return new h(function(){c=j.from(a(b)).getEnumerator()},function(){return c.moveNext()?this.yieldReturn(c.current()):!1},function(){f.dispose(c)})})},j.prototype.share=function(){var a,b=this,d=!1;return new m(function(){return new h(function(){null==a&&(a=b.getEnumerator())},function(){if(d)throw new Error("enumerator is disposed");return a.moveNext()?this.yieldReturn(a.current()):!1},c.Blank)},function(){d=!0,f.dispose(a)})},j.prototype.memoize=function(){var a,b,d=this,e=!1;return new m(function(){var f=-1;return new h(function(){null==b&&(b=d.getEnumerator(),a=[])},function(){if(e)throw new Error("enumerator is disposed");return f++,a.length<=f?b.moveNext()?this.yieldReturn(a[f]=b.current()):!1:this.yieldReturn(a[f])},c.Blank)},function(){e=!0,f.dispose(b),a=null})},j.prototype.catchError=function(a){a=f.createLambda(a);var b=this;return new j(function(){var c;return new h(function(){c=b.getEnumerator()},function(){try{return c.moveNext()?this.yieldReturn(c.current()):!1}catch(b){return a(b),!1}},function(){f.dispose(c)})})},j.prototype.finallyAction=function(a){a=f.createLambda(a);var b=this;return new j(function(){var c;return new h(function(){c=b.getEnumerator()},function(){return c.moveNext()?this.yieldReturn(c.current()):!1},function(){try{f.dispose(c)}finally{a()}})})},j.prototype.log=function(a){return a=f.createLambda(a),this.doAction(function(b){typeof console!==d.Undefined&&console.log(a(b))})},j.prototype.trace=function(a,b){return null==a&&(a="Trace"),b=f.createLambda(b),this.doAction(function(c){typeof console!==d.Undefined&&console.log(a,b(c))})};var k=function(a,b,c,d){this.source=a,this.keySelector=f.createLambda(b),this.descending=c,this.parent=d};k.prototype=new j,k.prototype.createOrderedEnumerable=function(a,b){return new k(this.source,a,b,this)},k.prototype.thenBy=function(a){return this.createOrderedEnumerable(a,!1)},k.prototype.thenByDescending=function(a){return this.createOrderedEnumerable(a,!0)},k.prototype.getEnumerator=function(){var a,b,d=this,e=0;return new h(function(){a=[],b=[],d.source.forEach(function(c,d){a.push(c),b.push(d)});var c=l.create(d,null);c.GenerateKeys(a),b.sort(function(a,b){return c.compare(a,b)})},function(){return e<b.length?this.yieldReturn(a[b[e++]]):!1},c.Blank)};var l=function(a,b,c){this.keySelector=a,this.descending=b,this.child=c,this.keys=null};l.create=function(a,b){var c=new l(a.keySelector,a.descending,b);return null!=a.parent?l.create(a.parent,c):c},l.prototype.GenerateKeys=function(a){for(var b=a.length,c=this.keySelector,d=new Array(b),e=0;b>e;e++)d[e]=c(a[e]);this.keys=d,null!=this.child&&this.child.GenerateKeys(a)},l.prototype.compare=function(a,b){var c=f.compare(this.keys[a],this.keys[b]);return 0==c?null!=this.child?this.child.compare(a,b):f.compare(a,b):this.descending?-c:c};var m=function(a,b){this.dispose=b,j.call(this,a)};m.prototype=new j;var n=function(a){this.getSource=function(){return a}};n.prototype=new j,n.prototype.any=function(a){return null==a?this.getSource().length>0:j.prototype.any.apply(this,arguments)},n.prototype.count=function(a){return null==a?this.getSource().length:j.prototype.count.apply(this,arguments)},n.prototype.elementAt=function(a){var b=this.getSource();return a>=0&&a<b.length?b[a]:j.prototype.elementAt.apply(this,arguments)},n.prototype.elementAtOrDefault=function(a,c){c===b&&(c=null);var d=this.getSource();return a>=0&&a<d.length?d[a]:c},n.prototype.first=function(a){var b=this.getSource();return null==a&&b.length>0?b[0]:j.prototype.first.apply(this,arguments)},n.prototype.firstOrDefault=function(a,c){if(c===b&&(c=null),null!=a)return j.prototype.firstOrDefault.apply(this,arguments);var d=this.getSource();return d.length>0?d[0]:c},n.prototype.last=function(a){var b=this.getSource();return null==a&&b.length>0?b[b.length-1]:j.prototype.last.apply(this,arguments)},n.prototype.lastOrDefault=function(a,c){if(c===b&&(c=null),null!=a)return j.prototype.lastOrDefault.apply(this,arguments);var d=this.getSource();return d.length>0?d[d.length-1]:c},n.prototype.skip=function(a){var b=this.getSource();return new j(function(){var d;return new h(function(){d=0>a?0:a},function(){return d<b.length?this.yieldReturn(b[d++]):!1},c.Blank)})},n.prototype.takeExceptLast=function(a){return null==a&&(a=1),this.take(this.getSource().length-a)},n.prototype.takeFromLast=function(a){return this.skip(this.getSource().length-a)},n.prototype.reverse=function(){var a=this.getSource();return new j(function(){var b;return new h(function(){b=a.length},function(){return b>0?this.yieldReturn(a[--b]):!1},c.Blank)})},n.prototype.sequenceEqual=function(a,b){return(a instanceof n||a instanceof Array)&&null==b&&j.from(a).count()!=this.count()?!1:j.prototype.sequenceEqual.apply(this,arguments)},n.prototype.toJoinedString=function(a,b){var c=this.getSource();return null==b&&c instanceof Array?(null==a&&(a=""),c.join(a)):j.prototype.toJoinedString.apply(this,arguments)},n.prototype.getEnumerator=function(){var a=this.getSource(),b=-1;return{current:function(){return a[b]},moveNext:function(){return++b<a.length},dispose:c.Blank}};var o=function(a,b){this.prevSource=a,this.prevPredicate=b};o.prototype=new j,o.prototype.where=function(a){if(a=f.createLambda(a),a.length<=1){var b=this.prevPredicate,c=function(c){return b(c)&&a(c)};return new o(this.prevSource,c)}return j.prototype.where.call(this,a)},o.prototype.select=function(a){return a=f.createLambda(a),a.length<=1?new p(this.prevSource,this.prevPredicate,a):j.prototype.select.call(this,a)},o.prototype.getEnumerator=function(){var a,b=this.prevPredicate,c=this.prevSource;return new h(function(){a=c.getEnumerator()},function(){for(;a.moveNext();)if(b(a.current()))return this.yieldReturn(a.current());return!1},function(){f.dispose(a)})};var p=function(a,b,c){this.prevSource=a,this.prevPredicate=b,this.prevSelector=c};p.prototype=new j,p.prototype.where=function(a){return a=f.createLambda(a),a.length<=1?new o(this,a):j.prototype.where.call(this,a)},p.prototype.select=function(a){if(a=f.createLambda(a),a.length<=1){var b=this.prevSelector,c=function(c){return a(b(c))};return new p(this.prevSource,this.prevPredicate,c)}return j.prototype.select.call(this,a)},p.prototype.getEnumerator=function(){var a,b=this.prevPredicate,c=this.prevSelector,d=this.prevSource;return new h(function(){a=d.getEnumerator()},function(){for(;a.moveNext();)if(null==b||b(a.current()))return this.yieldReturn(c(a.current()));return!1},function(){f.dispose(a)})};var q=function(){var a=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},e=function(a){return null===a?"null":a===b?"undefined":typeof a.toString===d.Function?a.toString():Object.prototype.toString.call(a)},f=function(a,b){this.key=a,this.value=b,this.prev=null,this.next=null},g=function(){this.first=null,this.last=null};g.prototype={addLast:function(a){null!=this.last?(this.last.next=a,a.prev=this.last,this.last=a):this.first=this.last=a},replace:function(a,b){null!=a.prev?(a.prev.next=b,b.prev=a.prev):this.first=b,null!=a.next?(a.next.prev=b,b.next=a.next):this.last=b},remove:function(a){null!=a.prev?a.prev.next=a.next:this.first=a.next,null!=a.next?a.next.prev=a.prev:this.last=a.prev}};var i=function(a){this.countField=0,this.entryList=new g,this.buckets={},this.compareSelector=null==a?c.Identity:a};return i.prototype={add:function(b,c){var d=this.compareSelector(b),g=e(d),h=new f(b,c);if(a(this.buckets,g)){for(var i=this.buckets[g],j=0;j<i.length;j++)if(this.compareSelector(i[j].key)===d)return this.entryList.replace(i[j],h),void(i[j]=h);i.push(h)}else this.buckets[g]=[h];this.countField++,this.entryList.addLast(h)},get:function(c){var d=this.compareSelector(c),f=e(d);if(!a(this.buckets,f))return b;for(var g=this.buckets[f],h=0;h<g.length;h++){var i=g[h];if(this.compareSelector(i.key)===d)return i.value}return b},set:function(b,c){var d=this.compareSelector(b),g=e(d);if(a(this.buckets,g))for(var h=this.buckets[g],i=0;i<h.length;i++)if(this.compareSelector(h[i].key)===d){var j=new f(b,c);return this.entryList.replace(h[i],j),h[i]=j,!0}return!1},contains:function(b){var c=this.compareSelector(b),d=e(c);if(!a(this.buckets,d))return!1;for(var f=this.buckets[d],g=0;g<f.length;g++)if(this.compareSelector(f[g].key)===c)return!0;return!1},clear:function(){this.countField=0,this.buckets={},this.entryList=new g},remove:function(b){var c=this.compareSelector(b),d=e(c);if(a(this.buckets,d))for(var f=this.buckets[d],g=0;g<f.length;g++)if(this.compareSelector(f[g].key)===c)return this.entryList.remove(f[g]),f.splice(g,1),0==f.length&&delete this.buckets[d],void this.countField--},count:function(){return this.countField},toEnumerable:function(){var a=this;return new j(function(){var b;return new h(function(){b=a.entryList.first},function(){if(null!=b){var a={key:b.key,value:b.value};return b=b.next,this.yieldReturn(a)}return!1},c.Blank)})}},i}(),r=function(a){this.count=function(){return a.count()},this.get=function(b){return j.from(a.get(b))},this.contains=function(b){return a.contains(b)},this.toEnumerable=function(){return a.toEnumerable().select(function(a){return new s(a.key,a.value)})}},s=function(a,b){this.key=function(){return a},n.call(this,b)};s.prototype=new n,typeof define===d.Function&&define.amd?define("linqjs",[],function(){return j}):typeof module!==d.Undefined&&module.exports?module.exports=j:a.Enumerable=j}(this),define("scalejs.linq-linqjs",["scalejs!core","linqjs"],function(a,b){b.Utils.extendTo(Array),a.registerExtension({linq:{enumerable:b}})}),define("scalejs.statechart-scion/state.builder",["scalejs!core","scion-ng"],function(a,b){return function(c){function d(a){return A(function(b){if(b.onEntry)throw new Error("Only one `onEntry` action is allowed.");if("function"!=typeof a)throw new Error("`onEntry` takes a function as a parameter.");return b.onEntry=a,b})}function e(a){return A(function(b){if(b.onExit)throw new Error("Only one `onExit` action is allowed.");if("function"!=typeof a)throw new Error("`onExit` takes a function as a parameter.");return b.onExit=a,b})}function f(a){return A(function(b){b.event=a})}function g(a){return A(function(b){b.cond=a})}function h(a,b,c){return A(function(d){return"state"===d.type||"parallel"===d.type?u(h(a,b,c))(d):(a&&(d.type="internal"),void("function"==typeof b?d.onTransition=b:(d.target=x(b,"array")?b:b.split(" "),c&&(d.onTransition=c))))})}function i(a,b){return h(!1,a,b)}function j(a,b){return h(!0,a,b)}function k(a){if("function"==typeof a)return A(function(b){b.onTransition=a});if("$yield"===a.kind)return a;throw new Error("Unsupported transition action",a)}function l(){var a,b=v.copy(arguments),c=b.pop();if(b.length>2)throw new Error("First (optional) argument should be event name, second (optional) argument should be a condition function");if("function"!=typeof c&&"$yield"!==c.kind)throw new Error("Last argument should be either `goto` or a function.");return a=b.map(function(a){if("string"==typeof a)return f(a);if("function"==typeof a)return g(a);throw new Error("Transition argument ",a," is not supported. First (optional) argument should be event name, second (optional) argument should be a condition function")}),A(u.apply(null,a.concat([k(c)])))}function m(){var a=v.copy(arguments),b=a.pop();if(a.forEach(function(a){if("string"!=typeof a)throw new Error("`whenInStates` accepts list of states and either `goto` or a function as the last argument.")}),"function"!=typeof b&&"$yield"!==b.kind)throw new Error("Last argument should be either `goto` or a function.");return A(u(g(function(b,c){return a.every(function(a){return c(a)})}),b))}function n(){var a=v.copy(arguments),b=a.pop();if(a.forEach(function(a){if("string"!=typeof a)throw new Error("`whenNotInStates` accepts list of states and either `goto` or a function as the last argument.")}),"function"!=typeof b&&"$yield"!==b.kind)throw new Error("Last argument should be either `goto` or a function.");return A(u(g(function(b,c){return a.every(function(a){return!c(a)})}),b))}function o(a){return A(function(b){return b.parallel?new Error("`initial` shouldn't be specified on parallel region."):void(b.initial=a)})}function p(c){return function(){var d,e,f;return d=s.apply(null,arguments),e=new b.Statechart(d,y({log:a.log.debug},c)),f=e._scriptingContext.raise,e._scriptingContext.raise=function(a){var b="string"==typeof a?{name:a}:a;f.call(e._scriptingContext,b)},e.send=function(a,b){return e._scriptingContext.send.call(e,a,b||{})},e}}var q,r,s,t,u,v=a.array,w=a.object.has,x=a.type.is,y=a.object.merge,z=a.functional.builder,A=z.$yield;return q=z({run:function(a,b){var c={};return c.type=w(b,"parallel")?"parallel":"state",a(c),c},delay:function(a){return a()},zero:function(){return function(){}},$yield:function(a){return a},combine:function(a,b){return function(c){a(c),b(c)}},missing:function(a){if("string"==typeof a)return function(b){if(b.id)throw new Error("Can't set state id to \""+a+'". state\'s id is already set to "'+b.id+'"');b.id=a};if("function"==typeof a)return a;if("state"===a.type||"parallel"===a.type)return function(b){b.states||(b.states=[]),b.states.push(a)};throw new Error("Missing builder for expression: "+JSON.stringify(a))}}),s=q(),t=q({parallel:!0}),r=z({run:function(a){return function(b){b.transitions||(b.transitions=[]);var c={};a(c),b.transitions.push(c)}},delay:function(a){return a()},zero:function(){return function(){}},$yield:function(a){return a},combine:function(a,b){return function(c){a(c),b(c)}},missing:function(a){if("function"==typeof a)return a;throw new Error('Unknown operation "'+a.kind+'" in transition expression',a)}}),u=r(),{builder:p,state:s,parallel:t,initial:o,onEntry:d,onExit:e,on:l,whenInStates:m,whenNotInStates:n,"goto":i,gotoInternally:j,statechart:p({logStatesEnteredAndExited:c.logStatesEnteredAndExited,log:a.log.debug})}}}),define("scalejs.statechart-scion/state",["scalejs!core","./state.builder","scion-ng","scalejs.functional","scalejs.linq-linqjs"],function(a,b,c){return function(d){function e(a){return t(a,"states")?q.make(a).concat(q.from(a.states).selectMany(e)):q.make(a)}function f(a,b){var c=e(a).firstOrDefault(function(a){return a.id===b});return c}function g(a,b){var c=e(a).firstOrDefault(function(a){return a.states&&a.states.some(function(a){return a.id===b})});return c}function h(){return v(function(a,b){var c,d;if(c=f(o,a),!c)throw new Error('Parent state "'+a+"\" doesn't exist");if(t(b,"id")&&(d=f(o,b.id)))throw new Error('State "'+b.id+'" already exists.');t(c,"states")||(c.states=[]),c.states.push(b)}).apply(null,arguments)}function i(b){if(a.isApplicationRunning())throw new Error("Can't register a state while application is running.");r(arguments,1).forEach(h(b))}function j(a,b){var c;if(c=f(o,a),!c)throw new Error('Parent state "'+a+"\" doesn't exist");b.expr(c)}function k(){if(a.isApplicationRunning())throw new Error("Can't unregister a state while application is running.");r(arguments).forEach(function(a){var b=g(o,a),c=q.from(b.states).first(function(b){return b.id===a});s(b.states,c)})}function l(a,b,c){var d;if(u(a,"string"))d={name:a};else{if(!t(a,"name"))throw new Error("event object should have `name` property.");d=a}!t(c)&&u(b,"number")?c=b:d.data=b,p.send(d,{delay:c})}function m(){return a.reactive.Observable.create(function(a){var b={onEntry:function(b,c){a.onNext({event:"entry",state:b,context:this,currentEvent:c})},onExit:function(b,c){a.onNext({event:"exit",state:b,currentEvent:c})},onTransition:function(b,c,d){a.onNext({event:"transition",source:b,targets:c,currentEvent:d})}};return p?p.registerListener(b):z.push(b),function(){p.unregisterListener(b)}})}function n(a){return function(b){m().where(function(b){return"entry"===b.event&&b.state===a}).take(1).subscribe(function(){b()})}}var o,p,q=a.linq.enumerable,r=a.array.toArray,s=a.array.removeOne,t=a.object.has,u=a.type.is,v=a.functional.curry,w=b(d),x=w.state,y=w.parallel,z=[];return o=x("scalejs-app",y("root")),a.onApplicationEvent(function(b){var e;switch(b){case"started":p=new c.Statechart(o,{logStatesEnteredAndExited:d.logStatesEnteredAndExited,log:a.log.debug}),e=p._scriptingContext.raise,p._scriptingContext.raise=function(a){var b="string"==typeof a?{name:a}:a;e.call(p._scriptingContext,b)},p.send=function(a,b){return p._scriptingContext.send.call(p,a,b||{})},z.forEach(function(a){p.registerListener(a)}),p.start();break;case"stopped":}}),{registerStates:i,registerTransition:j,unregisterStates:k,raise:l,observe:m,onState:n,builder:w}}}),define("scalejs.statechart-scion",["scalejs!core","./scalejs.statechart-scion/state","module"],function(a,b,c){a.registerExtension({state:b(c.config())})}),define("scalejs.routing-historyjs/routing",["scalejs!core","./history","./router","rx","scalejs.statechart-scion"],function(a,b,c,d){"use strict";function e(a){x?(x=!1,b.replace({url:a})):b.add({url:a})}function f(){var a;w.add(u().subscribe(function(a){var b;"entry"===a.event&&(b=c.tryToUrl(a.state,a.currentEvent?a.currentEvent.data:null),b&&e(b))})),w.add(b.observe().subscribe(function(b){var c=b.hash;a!==c&&(a=c,r("routed",{url:c},0))}))}function g(){w.dispose()}function h(a){return s(function(b){var d;c.addRoute(b.id,a),d=n("routed",function(a){var d=c.tryFromUrl(b.id,a.data.url);return d?(l(a.data,d),!0):void 0},o(b.id)),j?t(j,d):v.push(d)})}function i(a,b){var d,e;return j=a,k(b,"baseUrl")?(c.setBaseUrl(b.baseUrl),d=m(arguments).slice(2,arguments.length)):d=m(arguments).slice(1,arguments.length),e=q.apply(null,[j,n("router.disposing",o("router.disposed")),q("router.waiting",p(f)),q("router.disposed",p(g))].concat(v).concat(d))}var j,k=a.object.has,l=a.object.extend,m=a.array.toArray,n=a.state.builder.on,o=a.state.builder.gotoInternally,p=a.state.builder.onEntry,q=a.state.builder.state,r=a.state.raise,s=a.functional.builder.$yield,t=a.state.registerTransition,u=a.state.observe,v=[],w=new d.CompositeDisposable,x=!0;return{route:h,routerState:i}}),define("scalejs.routing-historyjs",["scalejs!core","./scalejs.routing-historyjs/routing"],function(a,b){"use strict";a.registerExtension({routing:b})});